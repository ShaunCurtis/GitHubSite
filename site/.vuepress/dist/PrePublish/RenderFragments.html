<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building a more Flexible App in Blazor | Cold Elm Coders</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.44eeee96.css" as="style"><link rel="preload" href="/assets/js/app.86c676cb.js" as="script"><link rel="preload" href="/assets/js/3.3d8b86b8.js" as="script"><link rel="preload" href="/assets/js/22.beab6558.js" as="script"><link rel="prefetch" href="/assets/js/1.3b0fc1ec.js"><link rel="prefetch" href="/assets/js/10.a274dc46.js"><link rel="prefetch" href="/assets/js/11.162f7736.js"><link rel="prefetch" href="/assets/js/12.360be8d5.js"><link rel="prefetch" href="/assets/js/13.b0705d6f.js"><link rel="prefetch" href="/assets/js/14.69de8028.js"><link rel="prefetch" href="/assets/js/15.2295ff60.js"><link rel="prefetch" href="/assets/js/16.25d1a337.js"><link rel="prefetch" href="/assets/js/17.8e7bbba4.js"><link rel="prefetch" href="/assets/js/18.af406209.js"><link rel="prefetch" href="/assets/js/19.93bf3e23.js"><link rel="prefetch" href="/assets/js/20.46485f16.js"><link rel="prefetch" href="/assets/js/21.1bf64d98.js"><link rel="prefetch" href="/assets/js/23.d907c9c3.js"><link rel="prefetch" href="/assets/js/24.397cc3c6.js"><link rel="prefetch" href="/assets/js/25.73196d04.js"><link rel="prefetch" href="/assets/js/26.be1183cd.js"><link rel="prefetch" href="/assets/js/27.17bef520.js"><link rel="prefetch" href="/assets/js/28.fbe88d68.js"><link rel="prefetch" href="/assets/js/29.7c12f388.js"><link rel="prefetch" href="/assets/js/30.257a3966.js"><link rel="prefetch" href="/assets/js/31.1ff03d7b.js"><link rel="prefetch" href="/assets/js/32.37438cf0.js"><link rel="prefetch" href="/assets/js/33.60f0f52b.js"><link rel="prefetch" href="/assets/js/34.953fc3f7.js"><link rel="prefetch" href="/assets/js/35.11e2895d.js"><link rel="prefetch" href="/assets/js/36.57d96982.js"><link rel="prefetch" href="/assets/js/37.10041584.js"><link rel="prefetch" href="/assets/js/38.20e2b07f.js"><link rel="prefetch" href="/assets/js/39.922ff1a8.js"><link rel="prefetch" href="/assets/js/4.0476436c.js"><link rel="prefetch" href="/assets/js/40.9f138f4b.js"><link rel="prefetch" href="/assets/js/41.d9afb87e.js"><link rel="prefetch" href="/assets/js/42.edbc37e4.js"><link rel="prefetch" href="/assets/js/43.a92b35d3.js"><link rel="prefetch" href="/assets/js/44.b058d9fc.js"><link rel="prefetch" href="/assets/js/45.1c88d4c6.js"><link rel="prefetch" href="/assets/js/46.3e8ddd11.js"><link rel="prefetch" href="/assets/js/47.6b9a4296.js"><link rel="prefetch" href="/assets/js/48.770d7b29.js"><link rel="prefetch" href="/assets/js/49.8fcbff2c.js"><link rel="prefetch" href="/assets/js/5.c21f6997.js"><link rel="prefetch" href="/assets/js/50.16da37c4.js"><link rel="prefetch" href="/assets/js/51.6a2306b6.js"><link rel="prefetch" href="/assets/js/52.b392e696.js"><link rel="prefetch" href="/assets/js/6.c00c814d.js"><link rel="prefetch" href="/assets/js/7.5a05fd84.js"><link rel="prefetch" href="/assets/js/8.a4f8ac88.js"><link rel="prefetch" href="/assets/js/9.62cada5e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.44eeee96.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cold Elm Coders</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/articles/" class="sidebar-link">Articles</a></li><li><a href="/archivedarticles/" class="sidebar-link">Articles</a></li><li><a href="/posts/" class="sidebar-link">Posts</a></li><li><a href="/Building-a-Database-Application-in-Blazor/" class="sidebar-link">Building a Database Application in Blazor</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="building-a-flexible-app-component-in-blazor"><a href="#building-a-flexible-app-component-in-blazor" class="header-anchor">#</a> Building a flexible App Component in Blazor</h1> <p>Publish Date: 2021-04-09
Last Updated: 2021-04-09</p> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p><code>App</code> is the root component in the Blazor UI.  This article looks how it functions and shows how to:</p> <ol><li>Add Dynamic Layouts - changing the default layout at runtime.</li> <li>Add Dynamic Routes - add and remove extra routes at runtime.</li> <li>Add Dynamic RouteViews - changing out the RouteView component directly without Routing.</li></ol> <p><img src="https://shauncurtis.github.io/siteimages/Articles/Editor-Controls/EditFormState.png" alt="EditForm"></p> <h2 id="code-and-examples"><a href="#code-and-examples" class="header-anchor">#</a> Code and Examples</h2> <p>The repository contains a project that implements the controls for all the articles in this series.  You can find it <a href="https://github.com/ShaunCurtis/Blazor.Database" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The example site is here <a href="https://cec-blazor-database.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://cec-blazor-database.azurewebsites.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>You can see the test form described later at <a href="https://cec-blazor-database.azurewebsites.net//testeditor" target="_blank" rel="noopener noreferrer">https://cec-blazor-database.azurewebsites.net//testeditor<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <blockquote><p>The Repo is a Work In Progress for future articles so will change and develop.</p></blockquote> <h2 id="the-blazor-application"><a href="#the-blazor-application" class="header-anchor">#</a> The Blazor Application</h2> <p><code>App</code> - normally defined in <em>App.razor</em> - is the root component in the Blazor RenderTree.  It's common across Web Assembly and Server contexts.</p> <p>In the Web Assembly context the startup page contains an element placeholder:</p> <div class="language-html extra-class"><pre class="language-html"><code>....
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Loading...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Which gets replaced when <code>Program</code> starts in the Web Assembly context.  The code line that defines which elemwent gets replaced with what component is:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token comment">// Replace the app id element with the component App</span>
    builder<span class="token punctuation">.</span>RootComponents<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>App<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the Server context <code>App</code> is declared directly as a component in Razor.  It gets pre-rendered by the server and then updated by the Blazor Server client in the browser.</p> <div class="language-html extra-class"><pre class="language-html"><code>...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>typeof(Blazor.App)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">render-mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ServerPrerendered<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="the-app-component"><a href="#the-app-component" class="header-anchor">#</a> The App Component</h2> <p><code>App</code> looks like this - a standard Razor component.</p> <p>It declares <code>Router</code> as it's local root component and sets <code>AppAssembly</code> to Assembly containing <code>Program</code>.  When Router gets rendered, which is only when <code>App</code> starts, it trawls <code>Assembly</code> to find all of it's routes. It has two <code>RenderFragments</code>, <code>Found</code> and <code>NotFound</code>.  When triggered by a routing event it looks for a route match.  If it finds one it renders <code>Found</code>, otherwise it renders <code>NotFound</code>.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Router</span> <span class="token attr-name">AppAssembly</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@typeof(Program).Assembly<span class="token punctuation">&quot;</span></span> <span class="token attr-name">PreferExactMatches</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Found</span> <span class="token attr-name">Context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>routeData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RouteView</span> <span class="token attr-name">RouteData</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@routeData<span class="token punctuation">&quot;</span></span> <span class="token attr-name">DefaultLayout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@typeof(MainLayout)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Found</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NotFound</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LayoutView</span> <span class="token attr-name">Layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@typeof(MainLayout)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Sorry, there's nothing at this address.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LayoutView</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NotFound</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Router</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>RouteView</code> is declared within <code>Found</code>.  <code>RouteData</code> is set to the router's current <code>routeData</code> object and <code>DefaultLayout</code> set to an application Layout <code>Type</code>.  <code>RouteView</code> renders <code>RouteData.Type</code> as a component within a Layout and applies any parameters in <code>RouteData.RouteValues</code>.</p> <p><code>NotFound</code> declares the <code>LayoutView</code> component, specifying a layout to use and some child content to render.</p> <h2 id="routeviewservice"><a href="#routeviewservice" class="header-anchor">#</a> RouteViewService</h2> <p>first we need a Service for state management.  This is <code>RouteViewService</code>.  To start, we set it up and add it to the WASM and Server Services.  The Server version a Singleton, but if you have user specific requirments then you may need to make it scoped or have two separate services to manage application and user contexts.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteViewService</span> 
<span class="token punctuation">{</span>
  <span class="token range operator">..</span><span class="token range operator">..</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In the Server it's added to <code>Startup</code> in <code>ConfigServices</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RouteViewService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In the Web Assembly context it's added to <code>Program</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RouteViewService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="renderfragments"><a href="#renderfragments" class="header-anchor">#</a> RenderFragments</h2> <p>What is a <code>RenderFragement</code>?  It's not a bunch of makeup code or a string.  Lets look at it's declaration in the Blazor Source code:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RenderFragment</span><span class="token punctuation">(</span><span class="token class-name">RenderTreeBuilder</span> builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">delegate</span> <span class="token return-type class-name">RenderFragment</span> <span class="token generic-method"><span class="token function">RenderFragment</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TValue<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">TValue</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>It's simply a delegate.  Any methods registered with the delegate get passed a <code>RenderTreeBuilder</code> object when they get executed.</p> <p>A declaration such as the one below declares a delegate named <code>_layoutViewFragement</code> that holds an anonymous function with the code declared within the body of the function.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _renderDelegate <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    _RenderEventQueued <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// Adds cascadingvalue for the ViewManager</span>
    builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CascadingValue<span class="token punctuation">&lt;</span>RouteViewManager<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get the layout render fragment</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;ChildContent&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_layoutViewFragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>RenderFragments</code> are queued with the <code>Renderer</code> though the <code>RenderHandle</code> which the component gets passed when it's attached to the <code>RenderTree</code>. The <code>Renderer</code> passes the <code>RenderFragment</code> it's <code>RenderTreeBuilder</code> instance when it executes the <code>RenderFragment</code>.   the <code>RenderFragment</code> runs it's code in the context of it's parent object instance and adds things to the <code>RenderTreeBuilder</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token range operator">..</span><span class="token range operator">..</span>
    _renderHandle<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span>_renderDelegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="routeviewmanager"><a href="#routeviewmanager" class="header-anchor">#</a> RouteViewManager</h3> <p><code>RouteViewManager</code> replaces <code>Routeview</code>.  It's based on <code>RouteView</code> and has all the functionality of <code>RouteView</code>.  We'll look at the key functionality in sections: it's rather large to show in it's entirety.</p> <p>When the router changes, <code>routeData</code> changes.  As a parameter on <code>RouteViewManager</code> this precipitates a call to <code>SetParametersAsync</code> on <code>RouteViewManager</code> through the <code>Renderer</code>.  <code>RouteViewManager</code> checks it has a valid <code>RouteData</code> and renders the component.  It also resets the <code>ViewData</code> to null because <code>ViewData</code> has precedence in the render process.  We're routing so we don't want to laod the last view.  The code is below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">await</span> <span class="token return-type class-name">Task</span> <span class="token function">SetParametersAsync</span><span class="token punctuation">(</span><span class="token class-name">ParameterView</span> parameters<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Sets the component parameters</span>
    parameters<span class="token punctuation">.</span><span class="token function">SetParameterProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Check if we have either RouteData or ViewData</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>RouteData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;The </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RouteView<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> component requires a non-null value for the parameter </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RouteData<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// we've routed and need to clear the ViewData</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ViewData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// Render the component</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Render</code> is set up to work from wherever it's called. <code>_RenderEventQueued</code> tracks if we have a render event in the queue, and prevents stacking multiple render events.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token function">InvokeAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_RenderEventQueued<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_RenderEventQueued <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            _renderHandle<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span>_renderDelegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>_renderDelegate</code> looks like this.  It cascades itself and then adds the <code>_layoutViewFragment</code> fragment as it's <code>ChildContent</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _renderDelegate <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// We're being executed so no longer queued</span>
    _RenderEventQueued <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// Adds cascadingvalue for the ViewManager</span>
    builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CascadingValue<span class="token punctuation">&lt;</span>RouteViewManager<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get the layout render fragment</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;ChildContent&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_layoutViewFragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>_layoutViewFragment</code> adds the correct layout (more later) and adds <code>_renderComponentWithParameters</code> as it's <code>ChildContent</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _layoutViewFragment <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LayoutView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>LayoutView<span class="token punctuation">.</span>Layout<span class="token punctuation">)</span><span class="token punctuation">,</span> _pageLayoutType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>LayoutView<span class="token punctuation">.</span>ChildContent<span class="token punctuation">)</span><span class="token punctuation">,</span> _renderComponentWithParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>_renderComponentWithParameters</code> makes the decision on whether it's rendering a View of a Route, and adds the appropriate component with it's parameters.  As you can see, views take precedence.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _renderComponentWithParameters <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_ViewData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Adds the defined view with any defined parameters</span>
        builder<span class="token punctuation">.</span><span class="token function">OpenComponent</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _ViewData<span class="token punctuation">.</span>ViewType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_ViewData<span class="token punctuation">.</span>ViewParameters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> kvp <span class="token keyword">in</span> _ViewData<span class="token punctuation">.</span>ViewParameters<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RouteData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">OpenComponent</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> RouteData<span class="token punctuation">.</span>PageType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> kvp <span class="token keyword">in</span> RouteData<span class="token punctuation">.</span>RouteValues<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> 
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">OpenElement</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;No Route or View Configured to Display&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>While this may seem a little convoluted, each <code>RenderFragment</code> is responsible for rendering a single component, and adding it's <em>child</em> as the <code>ChildContent</code>.</p> <h2 id="dynamic-layouts"><a href="#dynamic-layouts" class="header-anchor">#</a> Dynamic Layouts</h2> <p>Out-of-the-box Blazor layouts are defined at compile time and fixed at runtime.  <code>@Layout</code> is Razor talk that gets transposed when the Razor is pre-compiled to:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>LayoutAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">MainLayout</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>RouteAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>RouteAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">:</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>ComponentBase
<span class="token range operator">..</span><span class="token range operator">..</span>
</code></pre></div><p>To change Layouts dynamically we need somewhere to store the layout - in our case  we're using  <code>RouteViewService</code>. It can be set from any component that injects the service.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RouteViewService</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Type</span> Layout <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token range operator">..</span><span class="token range operator">..</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The layout is used by <code>RouteViewManager</code>.  <code>RouteViewManager</code> defines a readonly property <code>_pageLayoutType</code> to get the Layout.  It uses the null coalescing operator to get the layout on precedence.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">Type</span> _pageLayoutType <span class="token operator">=&gt;</span> RouteData<span class="token punctuation">?.</span>PageType<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetCustomAttribute</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LayoutAttribute<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">?.</span>LayoutType
    <span class="token operator">??</span> RouteViewService<span class="token punctuation">.</span>Layout
    <span class="token operator">??</span> DefaultLayout<span class="token punctuation">;</span>
</code></pre></div><p><code>_pageLayoutType</code> is applied to the component in the <code>_layoutViewFragment</code> render fragment.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _layoutViewFragment <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LayoutView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>LayoutView<span class="token punctuation">.</span>Layout<span class="token punctuation">)</span><span class="token punctuation">,</span> _pageLayoutType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>LayoutView<span class="token punctuation">.</span>ChildContent<span class="token punctuation">)</span><span class="token punctuation">,</span> _renderComponentWithParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>We'll see changing the layout in action later on the example page.</p> <h2 id="dynamic-routing"><a href="#dynamic-routing" class="header-anchor">#</a> Dynamic Routing</h2> <p>Dynamic Routing is a little more complicated.  <code>Router</code> is a sealed box, so it's take it as-is or re-write it.  Unless you must, don't.  With dynamic routing we're not looking to change existing routes, just add and remove dynamic routes.</p> <p>Routes are defined at compile time and are internal to the <code>Router</code> Component.  It trawls any assemblies provided and builds a route dictionary of component/route pairs that it uses to match the Url provided by the Navigation Manager when a navigation event occurs.  The Router wires into the <code>NavigationManager.LocationChanged</code> event to trigger route changes.</p> <p>RouteView Razor Pages are labelled like this:</p> <div class="language-html extra-class"><pre class="language-html"><code>@page &quot;/&quot;
@page &quot;/index&quot;
</code></pre></div><p>This is Razor talk, and gets transposed into the following in the C# class when pre-compiled.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>RouteAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>RouteAttribute</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;/index&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Index</span> <span class="token punctuation">:</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>ComponentBase
<span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span>
</code></pre></div><p>When <code>Router</code> finds a match for a Url it renders <code>Found</code> which renders our new <code>RouteViewManager</code>.  <code>RouteViewManager</code> builds out the Layout and adds a new instance of the component defined in <code>RouteData</code>.</p> <p>Let's look at what the router does when it doesn't find a route.</p> <p>Routing is triggered by the Navigation Manager.  It either:</p> <ol><li>Intercepts navigation in the DOM - anchors, etc.</li> <li>Is activated by a UI component calling it's <code>NavigateTo</code> method.</li></ol> <p>In either case the <code>LocationChanged</code> invokes any registered delegates passing them a <code>LocationChangedEventArgs</code> struct.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">readonly</span> <span class="token keyword">struct</span> <span class="token class-name">LocationChangedEventArgs</span>
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// The new location</span>
  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsNavigationIntercepted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre></div><p><code>IsNavigationIntercepted</code> is set to <code>ForceLoad</code> - default false - if the result of calling <code>NavigateTo</code> otherwise it's true.</p> <p>If we can avoid causing a hard navigation event in <code>Router</code>, we can add a component in <code>NotFound</code> to handle additional dynamic routing.  Not too difficult, it is our code!  We'll look at an enhanced <code>NavLink</code> control to help us further on.</p> <p>Routing stil works with a hard navigation event, but the application reloads: we'll soon see problem navigation events in testing!</p> <h3 id="customroutedata"><a href="#customroutedata" class="header-anchor">#</a> CustomRouteData</h3> <p><code>CustomRouteData</code> holds the information needed to make routing decisions.</p> <p>The class looks like this with inline detailed explanations.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomRouteData</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// The standard RouteData.</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">RouteData</span> RouteData <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">/// The PageType to load on a match </span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Type</span> PageType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">/// The Regex String to define the route</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> RouteMatch <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">/// Parameter values to add to the Route when created name/defaultvalue</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">SortedDictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> ComponentParameters <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SortedDictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// Method to check if we have a route match</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsMatch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// get the match</span>
            <span class="token class-name"><span class="token keyword">var</span></span> match <span class="token operator">=</span> Regex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RouteMatch<span class="token punctuation">,</span>RegexOptions<span class="token punctuation">.</span>IgnoreCase<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// create new dictionary object to add to the RouteData</span>
                <span class="token class-name"><span class="token keyword">var</span></span> dict <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//  check we have the same or fewer groups as parameters to map the to</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">.</span>Groups<span class="token punctuation">.</span>Count <span class="token operator">&gt;=</span> ComponentParameters<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token comment">// iterate through the parameters and add the next match</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> pars <span class="token keyword">in</span> ComponentParameters<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token class-name"><span class="token keyword">string</span></span> matchValue <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
                            matchValue <span class="token operator">=</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
                        <span class="token comment">//  Use a StypeSwitch object to do the Type Matching and create the dictionary pair </span>
                        <span class="token class-name"><span class="token keyword">var</span></span> ts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TypeSwitch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">Case</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>matchValue<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">int</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">else</span>
                                    dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> pars<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">Case</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">float</span></span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>matchValue<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">float</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">else</span>
                                    dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> pars<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">Case</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">decimal</span></span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">decimal</span><span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>matchValue<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">decimal</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                    dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">else</span>
                                    dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> pars<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">Case</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
                            <span class="token punctuation">{</span>
                                dict<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> matchValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        ts<span class="token punctuation">.</span><span class="token function">Switch</span><span class="token punctuation">(</span>pars<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        i<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// create a new RouteData object and assign it to the RouteData property. </span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>RouteData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RouteData</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>PageType<span class="token punctuation">,</span> dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> match<span class="token punctuation">.</span>Success<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// Method to check if we have a route match and return the RouteData</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsMatch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">RouteData</span> routeData<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            routeData <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RouteData<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">IsMatch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="updates-to-the-routeviewservice"><a href="#updates-to-the-routeviewservice" class="header-anchor">#</a> Updates to the RouteViewService</h2> <p>The relevant sections in <code>RouteViewService</code> are shown below. <code>Routes</code> holds the list of custom routes - it's left open so you can customize it.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>CustomRouteData<span class="token punctuation">&gt;</span></span> Routes <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>CustomRouteData<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">GetRouteMatch</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> url<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name">RouteData</span> routeData<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> route <span class="token operator">=</span> Routes<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">IsMatch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>route <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>EqualityComparer<span class="token operator">&lt;</span>RouteData<span class="token operator">&gt;</span><span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        routeData <span class="token operator">=</span> route<span class="token punctuation">.</span>RouteData<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        routeData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For test purposes the class <code>new</code> method creates some test routes.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token function">RouteViewService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> componentParameters <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SortedDictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    componentParameters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomRouteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> PageType <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Counter</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RouteMatch <span class="token operator">=</span> <span class="token string">@&quot;^\/counted\/(\d+)&quot;</span><span class="token punctuation">,</span> ComponentParameters <span class="token operator">=</span> componentParameters <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Routes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Routes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomRouteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> PageType <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">Counter</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RouteMatch <span class="token operator">=</span> <span class="token string">@&quot;^\/counters&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Routes<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CustomRouteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> PageType <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">RouteViewer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RouteMatch <span class="token operator">=</span> <span class="token string">@&quot;^\/routeviewer&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="the-routenotfoundmanager-component"><a href="#the-routenotfoundmanager-component" class="header-anchor">#</a> The RouteNotFoundManager Component</h2> <p><code>RouteNotFoundManager</code> is a simpler version of <code>RouteViewManager</code>.  We'll look at the relevant sections below.</p> <p><code>SetParametersAsync</code> is called when the component is loaded.  It gets the local Url and calls <code>GetRouteMatch</code> on <code>RouteViewService</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">SetParametersAsync</span><span class="token punctuation">(</span><span class="token class-name">ParameterView</span> parameters<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    parameters<span class="token punctuation">.</span><span class="token function">SetParameterProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Get the route url</span>
    <span class="token class-name"><span class="token keyword">var</span></span> url <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">NavManager<span class="token punctuation">.</span>Uri<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span>NavManager<span class="token punctuation">.</span>BaseUri<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
    <span class="token comment">// check if we have a custom route and if so use it</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>RouteViewService<span class="token punctuation">.</span><span class="token function">GetRouteMatch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">var</span></span> routedata<span class="token punctuation">)</span><span class="token punctuation">)</span>
        _routeData <span class="token operator">=</span> routedata<span class="token punctuation">;</span>
    <span class="token comment">// if The layout is blank show the ChildContent without a layout </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_pageLayoutType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        _renderHandle<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span>ChildContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// otherwise show the route or ChildContent inside the layout</span>
    <span class="token keyword">else</span>
        _renderHandle<span class="token punctuation">.</span><span class="token function">Render</span><span class="token punctuation">(</span>_ViewFragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>_ViewFragment</code> builds either a <code>RouteViewManager</code> if it finds a custom route or the contents of <code>RouteNotFoundManager</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// Layouted Render Fragment</span>
<span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _ViewFragment <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// check if we have a RouteData object and if so load the RouteViewManager, otherwise the ChildContent</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_routeData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>RouteViewManager<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>RouteViewManager<span class="token punctuation">.</span>DefaultLayout<span class="token punctuation">)</span><span class="token punctuation">,</span> _pageLayoutType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>RouteViewManager<span class="token punctuation">.</span>RouteData<span class="token punctuation">)</span><span class="token punctuation">,</span> _routeData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>LayoutView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>LayoutView<span class="token punctuation">.</span>Layout<span class="token punctuation">)</span><span class="token punctuation">,</span> _pageLayoutType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">nameof</span><span class="token punctuation">(</span>LayoutView<span class="token punctuation">.</span>ChildContent<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ChildContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="switching-the-route-view-without-routing"><a href="#switching-the-route-view-without-routing" class="header-anchor">#</a> Switching the Route View Without Routing</h2> <p>Switching the RouteView without routing has several possible applications.  These are some I've used:</p> <ol><li>Hide direct access to the page, and only be able to navigate to it within the application.</li> <li>Multipart forms/processes with a single entry point.  The state of the saved form/process dictates which form gets loaded.</li> <li>Context dependant forms or information.  Login/logout/signup is a good example.  The same page but with a different routeviews loaded.</li></ol> <h3 id="viewdata"><a href="#viewdata" class="header-anchor">#</a> ViewData</h3> <p>The equivalent to <code>RouteData</code>.  It needs no explaining.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ViewData</span>
<span class="token punctuation">{</span>
    <span class="token comment">/// Gets the type of the View.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Type</span> ViewType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">/// Gets the type of the page matching the route.</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Type</span> LayoutType <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">/// Parameter values to add to the Route when created</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> ViewParameters <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// Constructs an instance of &lt;see cref=&quot;ViewData&quot;/&gt;.</span>
    <span class="token keyword">public</span> <span class="token function">ViewData</span><span class="token punctuation">(</span><span class="token class-name">Type</span> viewType<span class="token punctuation">,</span> <span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> viewValues <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>viewType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentNullException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>viewType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ViewType <span class="token operator">=</span> viewType<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>viewValues <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewParameters <span class="token operator">=</span> viewValues<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>All the functionality is implemented in <code>RouteViewManager</code>.</p> <h3 id="routeviewmanager-2"><a href="#routeviewmanager-2" class="header-anchor">#</a> RouteViewManager</h3> <p>First some properties and fields.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// The size of the History list used for Views.</span>
<span class="token punctuation">[</span>Parameter<span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ViewHistorySize <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">/// Gets and sets the view data.</span>
<span class="token keyword">public</span> <span class="token return-type class-name">ViewData</span> ViewData
<span class="token punctuation">{</span>
    <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_ViewData<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token keyword">set</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">AddViewToHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_ViewData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_ViewData <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Property that stores the View History.  It's size is controlled by ViewHistorySize</span>
<span class="token keyword">public</span> <span class="token return-type class-name">SortedList<span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">,</span> ViewData<span class="token punctuation">&gt;</span></span> ViewHistory <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SortedList<span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">,</span> ViewData<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/// Gets the last view data.</span>
<span class="token keyword">public</span> <span class="token return-type class-name">ViewData</span> LastViewData
<span class="token punctuation">{</span>
    <span class="token keyword">get</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> newest <span class="token operator">=</span> ViewHistory<span class="token punctuation">.</span><span class="token function">Max</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>Key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newest <span class="token operator">!=</span> <span class="token keyword">default</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ViewHistory<span class="token punctuation">[</span>newest<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Method to check if &lt;param name=&quot;view&quot;&gt; is the current View</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">IsCurrentView</span><span class="token punctuation">(</span><span class="token class-name">Type</span> view<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewData<span class="token punctuation">?.</span>ViewType <span class="token operator">==</span> view<span class="token punctuation">;</span>

<span class="token comment">/// Boolean to check if we have a View set</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> HasView <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_ViewData<span class="token punctuation">?.</span>ViewType <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">/// Internal ViewData used by the component</span>
<span class="token keyword">private</span> <span class="token return-type class-name">ViewData</span> _ViewData <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre></div><p>A set of <code>LoadViewAsync</code> to provide a variety of ways to load a new view.  The main method sets the internal <code>viewData</code> field and calls <code>Render</code> to re-render the component.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// The main method</span>
<span class="token keyword">public</span> <span class="token keyword">await</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token class-name">ViewData</span> viewData <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>viewData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewData <span class="token operator">=</span> viewData<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ViewData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;The </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RouteViewManager<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> component requires a non-null value for the parameter </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>ViewData<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">.&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token class-name">Type</span> viewtype<span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ViewData</span><span class="token punctuation">(</span>viewtype<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token generic-method"><span class="token function">LoadViewAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">ViewData</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">TView</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The <code>_renderComponentWithParameters</code> property render fragment contains the code that builds out the RouteView component.  If there's a valid <code>_ViewData</code> object, it uses the <code>ViewData</code>.  If not it uses <code>RouteData</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name">RenderFragment</span> _renderComponentWithParameters <span class="token operator">=&gt;</span> builder <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_ViewData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Adds the defined view with any defined parameters</span>
        builder<span class="token punctuation">.</span><span class="token function">OpenComponent</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _ViewData<span class="token punctuation">.</span>ViewType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_ViewData<span class="token punctuation">.</span>ViewParameters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> kvp <span class="token keyword">in</span> _ViewData<span class="token punctuation">.</span>ViewParameters<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>RouteData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">OpenComponent</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> RouteData<span class="token punctuation">.</span>PageType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> kvp <span class="token keyword">in</span> RouteData<span class="token punctuation">.</span>RouteValues<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> kvp<span class="token punctuation">.</span>Value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> 
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">OpenElement</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;No Route or View Configured to Display&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">CloseElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code></code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code></code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.86c676cb.js" defer></script><script src="/assets/js/3.3d8b86b8.js" defer></script><script src="/assets/js/22.beab6558.js" defer></script>
  </body>
</html>
