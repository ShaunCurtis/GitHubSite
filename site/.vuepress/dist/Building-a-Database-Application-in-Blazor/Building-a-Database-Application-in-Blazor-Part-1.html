<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Part 1 - Project Structure and Framework | Cold Elm Coders</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.dd68a41e.css" as="style"><link rel="preload" href="/assets/js/app.0784ea42.js" as="script"><link rel="preload" href="/assets/js/3.36dc20da.js" as="script"><link rel="preload" href="/assets/js/12.f7a15c90.js" as="script"><link rel="prefetch" href="/assets/js/10.b9150889.js"><link rel="prefetch" href="/assets/js/11.e135ddc5.js"><link rel="prefetch" href="/assets/js/13.3853eda2.js"><link rel="prefetch" href="/assets/js/14.0e4ef0bd.js"><link rel="prefetch" href="/assets/js/15.2319b6a1.js"><link rel="prefetch" href="/assets/js/16.e30cd155.js"><link rel="prefetch" href="/assets/js/17.3c9aa520.js"><link rel="prefetch" href="/assets/js/18.1d0bae0d.js"><link rel="prefetch" href="/assets/js/19.40396d12.js"><link rel="prefetch" href="/assets/js/2.d8f0ea9c.js"><link rel="prefetch" href="/assets/js/20.5255d394.js"><link rel="prefetch" href="/assets/js/21.28affb46.js"><link rel="prefetch" href="/assets/js/22.dba79a01.js"><link rel="prefetch" href="/assets/js/23.02383450.js"><link rel="prefetch" href="/assets/js/24.4367ae2b.js"><link rel="prefetch" href="/assets/js/25.2db7d111.js"><link rel="prefetch" href="/assets/js/26.66b39366.js"><link rel="prefetch" href="/assets/js/27.73333f76.js"><link rel="prefetch" href="/assets/js/28.f57d772c.js"><link rel="prefetch" href="/assets/js/29.75fe04f9.js"><link rel="prefetch" href="/assets/js/30.4fa924f3.js"><link rel="prefetch" href="/assets/js/31.3bc4b09a.js"><link rel="prefetch" href="/assets/js/32.e73a9df8.js"><link rel="prefetch" href="/assets/js/33.3c5c3e6d.js"><link rel="prefetch" href="/assets/js/34.26f37993.js"><link rel="prefetch" href="/assets/js/35.6fd0d388.js"><link rel="prefetch" href="/assets/js/36.d4a64a71.js"><link rel="prefetch" href="/assets/js/37.6a94a955.js"><link rel="prefetch" href="/assets/js/38.889dc17c.js"><link rel="prefetch" href="/assets/js/39.975067e9.js"><link rel="prefetch" href="/assets/js/4.e0f17090.js"><link rel="prefetch" href="/assets/js/40.4f36b71b.js"><link rel="prefetch" href="/assets/js/5.19ad076b.js"><link rel="prefetch" href="/assets/js/6.7cbf098b.js"><link rel="prefetch" href="/assets/js/7.b3f67ab4.js"><link rel="prefetch" href="/assets/js/8.39d73ebe.js"><link rel="prefetch" href="/assets/js/9.756a2b3d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dd68a41e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cold Elm Coders</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link router-link-active">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link router-link-active">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Blazor Database Application</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Building-a-Database-Application-in-Blazor/" aria-current="page" class="sidebar-link">Building a Database Application in Blazor</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html" aria-current="page" class="active sidebar-link">Part 1 - Project Structure and Framework</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#repository-and-database" class="sidebar-link">Repository and Database</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#solution-structure" class="sidebar-link">Solution Structure</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#design-philosophy" class="sidebar-link">Design Philosophy</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#ui-structure" class="sidebar-link">UI Structure</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#cec-blazor-wasm-client-project" class="sidebar-link">CEC.Blazor.WASM.Client Project</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#cec-blazor-wasm-server-project" class="sidebar-link">CEC.Blazor.WASM.Server Project</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#cec-blazor-server-project" class="sidebar-link">CEC.Blazor.Server Project</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#wrap-up" class="sidebar-link">Wrap Up</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html#history" class="sidebar-link">History</a></li></ul></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html" class="sidebar-link">Part 2 - Services - Building the CRUD Data Layers</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html" class="sidebar-link">Part 3 - View Components - CRUD Edit and View Operations in the UI</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-4.html" class="sidebar-link">Part 4 - UI Components</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-5.html" class="sidebar-link">Part 5 - View Components - CRUD List Operations in the UI</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-6.html" class="sidebar-link">Part 6 - Adding new Record Types and Their UI to the Weather Application</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="building-a-database-application-in-blazor"><a href="#building-a-database-application-in-blazor" class="header-anchor">#</a> Building a Database Application in Blazor</h1> <h1 id="part-1-project-structure-and-framework"><a href="#part-1-project-structure-and-framework" class="header-anchor">#</a> Part 1 - Project Structure and Framework</h1> <p>This set of articles looks at how to build and structure a real Database Application in Blazor.  There are 6 articles:</p> <ol><li>Project Structure and Framework.</li> <li>Services - Building the CRUD Data Layers.</li> <li>View Components - CRUD Edit and View Operations in the UI.</li> <li>UI Components - Building HTML/CSS Controls.</li> <li>View Components - CRUD List Operations in the UI.</li> <li>A walk through detailing how to add weather stations and weather station data to the application.</li></ol> <p>The articles describe my current framework for developing Blazor applications.  They have been significantly revised from their original release:</p> <ol><li>The libraries have significant coding updates, particularly in the Data Services.</li> <li>Everything has been updated to Net5.</li> <li>The Repo home has moved.</li> <li>Some core functionality has moved into the <em>CEC.Blazor.Core</em> library available though publically available Nuget packages.</li> <li>The Server and WASM applications have been combined onto a single site.</li></ol> <p>They are not:</p> <ol><li>An attempt to define best practice.</li> <li>The finished product.</li></ol> <p>Use as much or as little as you like, and please offer suggestions.</p> <p>While my code and methodologies may be opinionated, I try not to make assertions about the right and wrong ways of doing things.  I do make a few suggestions, to steer those new to Blazor away from dark holes.  For example, I recommend parking the term <code>Page</code>.  A routed component isn't a page.  Label it a page, even subconsciously, and it gains web page attributes that simply don't apply.    I use the term <strong>Views</strong> after the component that displays them - <code>RouteView</code>.</p> <p>This first section describes my slighlty radical development approach and walks runs through two projects on the GitHub repository - a Blazor Server and WASM/Backend API project - explaining the structure.</p> <h2 id="repository-and-database"><a href="#repository-and-database" class="header-anchor">#</a> Repository and Database</h2> <p>The repository for the articles has moved to <a href="https://github.com/ShaunCurtis/CEC.Blazor.SPA" target="_blank" rel="noopener noreferrer">CEC.Blazor.SPA Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  <a href="https://github.com/ShaunCurtis/CEC.Blazor" target="_blank" rel="noopener noreferrer">CEC.Blazor GitHub Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is now obselete and will be removed.</p> <p>There's a SQL script in /SQL in the repository for building the database.</p> <p>The Server and WASM versions of the site have been combined into a single site.  You can switch between the two in the left hand menu.  The site starts in Server mode - <a href="https://cec-blazor-server.azurewebsites.net/" target="_blank" rel="noopener noreferrer">https://cec-blazor-server.azurewebsites.net/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  The WASM server site exists for bebugging WASM code only.</p> <p>Serveral classes described here are part of the separate <em>CEC.Blazor.Core</em> library.  The Github is <a href="https://github.com/ShaunCurtis/CEC.Blazor.Core" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and is available as a Nuget Package.</p> <h2 id="solution-structure"><a href="#solution-structure" class="header-anchor">#</a> Solution Structure</h2> <p>I use Visual Studio, so the Github repository consists of a solution with five projects.  These are:</p> <ol><li>CEC.Blazor.SPA - the core library containing everything that can be boilerplated and reused across any project.</li> <li>CEC.Weather - this is the library shared by both the Server and WASM projests.  Almost all the project code lives here.  Examples are the EF DB Context, Model classes, model specific CRUD components, Bootstrap SCSS, Views, Forms, ...</li> <li>CEC.Blazor.Server - the combined Server/WASM project.</li> <li>CEC.Blazor.WASM.Server - the WASM backend server project.  Used for testing/debugging the WASM code.</li> <li>CEC.Blazor.WASM.Client - the WASM Client project.</li></ol> <p>Along with the standard Nuget libraries, the solution uses <em>CEC.Blazor.Core</em> which contains the ViewManager and core View management classes.</p> <h2 id="design-philosophy"><a href="#design-philosophy" class="header-anchor">#</a> Design Philosophy</h2> <p>The data side of the project is structured fairly conventionally, loosely based on the three tier - data, logical and presentation layer - model.  The exposed data classes all run as Services and are available for dependency injection.  I have adopted a record based approach to the data.  Data read from the database is immutable.  Editors use <code>RecordEditContext</code> classes that manage edit state and validation and produce a new copy of a record for writing back to the database.   The detail is covered in the second and third articles.</p> <p>The UI is more radical:</p> <ol><li>A custom <code>Component</code> class is used as the base UI component - <code>ComponentBase</code> is only used by the out-of-the-box data controls.</li> <li>Routing is discarded.  There's a new <code>ViewManager</code> that manages the UI.</li></ol> <h2 id="ui-structure"><a href="#ui-structure" class="header-anchor">#</a> UI Structure</h2> <h3 id="pages"><a href="#pages" class="header-anchor">#</a> Pages</h3> <p>Pages are the web pages that act as the host for the the application.  There's one per application.</p> <h3 id="viewmanager"><a href="#viewmanager" class="header-anchor">#</a> ViewManager</h3> <p>The <code>ViewManager</code> is the sub-root component in the RenderTree, loaded by App.  It's purpose is to manage and load Views.  The supporting <code>ViewData</code> class is used to store View configuration data.  The main  method used is <code>LoadViewAsync</code>.  There are various versions, but all load the View defined in <code>ViewData</code>.  <code>ViewManager</code> exposes itself to all other components through a cascading value.</p> <h3 id="views"><a href="#views" class="header-anchor">#</a> Views</h3> <p>Views are the components loaded into the page by <code>ViewManager</code>.  They must implement <code>IView</code> and can define a Layout.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IView</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IComponent</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// provides a unique reference for the instance of the view</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> GUID <span class="token operator">=&gt;</span> Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// The cascaded ViewManager Instance</span>
        <span class="token punctuation">[</span>CascadingParameter<span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">ViewManager</span> ViewManager <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="layouts"><a href="#layouts" class="header-anchor">#</a> Layouts</h3> <p>Layouts are out-of-the-box Blazor Layouts.  The ViewManager renders the Layout with the <code>View</code> as the child content in the same way that the <code>Router</code> component does.</p> <h3 id="forms"><a href="#forms" class="header-anchor">#</a> Forms</h3> <p>Forms are logical collections of controls that are either displayed in a view or a modal dialog.  Lists, view forms, edit forms are all classic forms. Forms contain controls not HTML.</p> <h3 id="controls"><a href="#controls" class="header-anchor">#</a> Controls</h3> <p>Controls are components that display something: they emit HTML code.  For example, an edit box, a dropdown, button, ... A Form is a collection of controls.</p> <h2 id="cec-blazor-wasm-client-project"><a href="#cec-blazor-wasm-client-project" class="header-anchor">#</a> CEC.Blazor.WASM.Client Project</h2> <p><img src="https://raw.githubusercontent.com/ShaunCurtis/CEC.Blazor.SPA/master/Images/CEC-Weather-WASM-Client-Project-View.png" alt="Project Files"></p> <p>The project is almost empty.  The controls and services are all in the libraries.  It contains only the code needed to build the WASM executable.</p> <h3 id="program-cs"><a href="#program-cs" class="header-anchor">#</a> Program.cs</h3> <p><code>CEC.Blazor</code> and local application services are loaded.  Note the Blazor root component is defined here.  You don't have to use <code>App</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> WebAssemblyHostBuilder<span class="token punctuation">.</span><span class="token function">CreateDefault</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Full class name used here to make it a little more obvious.  Not required if the assemble is referenced.</span>
    builder<span class="token punctuation">.</span>RootComponents<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CEC<span class="token punctuation">.</span>Weather<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>App<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Added here as we don't have access to builder in AddApplicationServices</span>
    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddScoped</span><span class="token punctuation">(</span>sp <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span> <span class="token punctuation">{</span> BaseAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span>builder<span class="token punctuation">.</span>HostEnvironment<span class="token punctuation">.</span>BaseAddress<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// the Services for the CEC.Blazor Library</span>
    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddCECBlazorSPA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// the local application Services defined in ServiceCollectionExtensions.cs</span>
    builder<span class="token punctuation">.</span>Services<span class="token punctuation">.</span><span class="token function">AddApplicationServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> builder<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">RunAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Services for each project/library are specified in <code>IServiceCollection</code> Extensions.</p> <h4 id="servicecollectionextensions-cs"><a href="#servicecollectionextensions-cs" class="header-anchor">#</a> ServiceCollectionExtensions.cs</h4> <p>The site specific services loaded are the controller service <code>WeatherForecastControllerService</code> and the data service as an <code>IWeatherForecastDataService</code> interface loading  <code>WeatherForecastWASMDataService</code>.  The final transient service is the Fluent Validator for the Edit form.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceCollectionExtensions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IServiceCollection</span> <span class="token function">AddApplicationServices</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Scoped service for the WASM Client version of WASM Factory Data Service </span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IFactoryDataService<span class="token punctuation">&lt;</span>WeatherForecastDbContext<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> FactoryWASMDataService<span class="token punctuation">&lt;</span>WeatherForecastDbContext<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Scoped service for the WeatherForecast Controller Services</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecastControllerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherStationControllerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherReportControllerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> services<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="cec-blazor-wasm-server-project"><a href="#cec-blazor-wasm-server-project" class="header-anchor">#</a> CEC.Blazor.WASM.Server Project</h2> <p>The <em>CEC.Blazor.WASM.Server</em> project only exists for debugging the WASM project.  All files are copies of the originals from <em>CEC.Blazor.Server</em>.</p> <p><img src="https://raw.githubusercontent.com/ShaunCurtis/CEC.Blazor.SPA/master/Images/CEC-Weather-WASM-Server-Project-View.png?raw=true" alt="Project Files"></p> <p>The only files in the server project, other than error handling for anyone trying to navigate to the site, are the WeatherForecast Controller and the startup/program files.</p> <h4 id="servicecollectionextensions-cs-2"><a href="#servicecollectionextensions-cs-2" class="header-anchor">#</a> ServiceCollectionExtensions.cs</h4> <p>The site specific service is a singleton <code>IWeatherForecastDataService</code> interface loading either <code>WeatherForecastServerDataService</code> or <code>WeatherForecastDummyDataService</code>. <code>WeatherForecastDummyDataService</code> is for demo purposes and doesn't need a backend SQL database. It does what it says, creates an in-application dataset.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ServiceCollectionExtensions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IServiceCollection</span> <span class="token function">AddApplicationServices</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// You have a choice of data sources.</span>
        <span class="token comment">// services.AddSingleton&lt;IFactoryDataService&lt;WeatherForecastDbContext&gt;, FactoryServerDataService&lt;WeatherForecastDbContext&gt;&gt;();</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IFactoryDataService<span class="token punctuation">&lt;</span>WeatherForecastDbContext<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> WeatherDummyDataService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Factory for building the DBContext </span>
        <span class="token class-name"><span class="token keyword">var</span></span> dbContext <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;Configuration:DBContext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContextFactory</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecastDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>dbContext<span class="token punctuation">)</span><span class="token punctuation">,</span> ServiceLifetime<span class="token punctuation">.</span>Singleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> services<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="startup-cs"><a href="#startup-cs" class="header-anchor">#</a> Startup.cs</h4> <p>Note that the default endpoint is set to <em>wwwroot/wasm.html</em>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    services<span class="token punctuation">.</span><span class="token function">AddControllersWithViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token function">AddApplicationServices</span><span class="token punctuation">(</span>Configuration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span><span class="token function">UseWebAssemblyDebugging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseExceptionHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span><span class="token function">UseHsts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    app<span class="token punctuation">.</span><span class="token function">UseHttpsRedirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">UseBlazorFrameworkFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// default endpoint set to the file: wwwroot/wasm.html</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapFallbackToFile</span><span class="token punctuation">(</span><span class="token string">&quot;wasm.html&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="wasm-html"><a href="#wasm-html" class="header-anchor">#</a> wasm.html</h3> <p><code>wasm.html</code> is an almost out-of-the-box  <code>index.html</code> with:</p> <ol><li>Added stylesheet references.  Note that you use the virtual directory <code>_content/Assembly_Name</code> to access content exposed in the <code>wwwroot</code> folders of dependency assembles and the reference to the component styling - <code>CEC.Weather.WASM.Server.styles.css</code>.  Scripts are accessed in the same way.</li> <li>The base content of <code>app</code> is an HTML block that displays a spinner while the application is initializing.</li></ol> <p><img src="https://github.com/ShaunCurtis/CEC.Blazor.SPA/blob/master/Images/WASM-Start-Screen.png?raw=true" alt="App Start Screen"></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>CEC.Blazor.WASM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CEC.Weather.WASM.Server.styles.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_content/CEC.Blazor.SPA/site.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_content/CEC.Weather/css/site.min.css<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mt-4<span class="token punctuation">&quot;</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span>auto<span class="token punctuation">;</span> <span class="token property">margin-left</span><span class="token punctuation">:</span>auto<span class="token punctuation">;</span> <span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loader<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token style language-css"><span class="token property">width</span><span class="token punctuation">:</span>100%<span class="token punctuation">;</span> <span class="token property">text-align</span><span class="token punctuation">:</span>center<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>Web Application Loading<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>blazor-error-ui<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        An unhandled error has occurred.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>reload<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Reload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dismiss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ðŸ—™<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_framework/blazor.webassembly.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_content/CEC.Blazor.SPA/site.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="css"><a href="#css" class="header-anchor">#</a> CSS</h3> <p>All CSS is shared, so lives in <code>CEC.Weather</code>.  I use Bootstrap, customized a little with SASS.  I have the WEB COMPILER extension installed in Visual Studio to compile SASS files on the fly.</p> <h2 id="cec-blazor-server-project"><a href="#cec-blazor-server-project" class="header-anchor">#</a> CEC.Blazor.Server Project</h2> <p><img src="https://github.com/ShaunCurtis/CEC.Blazor.SPA/blob/master/Images/CEC-Weather-Server-Project-View.png?raw=true" alt="Project Files"></p> <h4 id="pages-2"><a href="#pages-2" class="header-anchor">#</a> Pages</h4> <p>We have one real page - the standard issue <code>_Host.cshtml</code>.  As we're running on the server this is an Aspnetcore server-side page.</p> <ol><li>Added stylesheet references.  Note that you use the virtual directory <code>_content/Assembly_Name</code> to access content exposed in the <code>wwwroot</code> folders of dependency assembles and the reference to the component styling - <code>CEC.Weather.WASM.Server.styles.css</code>..  Scripts are accessed in the same way.</li> <li>The base content of <code>app</code> uses a TagHelper to load the root component - in this case <code>CEC.Weather.Components.App</code>.  Again, you're not tied to App, just specify a different component class.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@page <span class="token string">&quot;/&quot;</span>
@<span class="token keyword">namespace</span> CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Pages
@addTagHelper <span class="token operator">*</span><span class="token punctuation">,</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">.</span>TagHelpers
@<span class="token punctuation">{</span>
    Layout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name">html</span> lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">meta</span> charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">meta</span> name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>CEC<span class="token punctuation">.</span>Blazor<span class="token punctuation">.</span>Server<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token keyword">base</span> href<span class="token operator">=</span><span class="token string">&quot;~/&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> href<span class="token operator">=</span><span class="token string">&quot;https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i&quot;</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;CEC.Weather.Server.styles.css&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;_content/CEC.Blazor.SPA/site.min.css&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">link</span> rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;_content/CEC.Weather/css/site.min.css&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>app<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">component</span> type<span class="token operator">=</span><span class="token string">&quot;typeof(CEC.Weather.Components.App)&quot;</span> render<span class="token operator">-</span>mode<span class="token operator">=</span><span class="token string">&quot;Server&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>app<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">div</span> id<span class="token operator">=</span><span class="token string">&quot;blazor-error-ui&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">environment</span> include<span class="token operator">=</span><span class="token string">&quot;Staging,Production&quot;</span><span class="token operator">&gt;</span>
            An error has occurred<span class="token punctuation">.</span> This application may no longer respond until reloaded<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>environment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">environment</span> include<span class="token operator">=</span><span class="token string">&quot;Development&quot;</span><span class="token operator">&gt;</span>
            An unhandled exception has occurred<span class="token punctuation">.</span> See browser dev tools <span class="token keyword">for</span> details<span class="token punctuation">.</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>environment<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token class-name">a</span> href<span class="token operator">=</span><span class="token string">&quot;&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;reload&quot;</span><span class="token operator">&gt;</span>Reload<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dismiss&quot;</span><span class="token operator">&gt;</span>ðŸ—™<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">script</span> src<span class="token operator">=</span><span class="token string">&quot;_framework/blazor.server.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token class-name">script</span> src<span class="token operator">=</span><span class="token string">&quot;_content/CEC.Blazor.SPA/site.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><h3 id="wasm-html-2"><a href="#wasm-html-2" class="header-anchor">#</a> wasm.html</h3> <p><code>wasm.html</code> is a copy of <code>wasm.html</code> from the <em>CEC.Weather.WASM.Server</em>.  It's the entry point for the WASM version of the application.</p> <h4 id="startup-cs-2"><a href="#startup-cs-2" class="header-anchor">#</a> Startup.cs</h4> <p>The local services and <code>CEC.Blazor.SPA</code> library services are added.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddControllersWithViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token function">AddRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token function">AddServerSideBlazor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token function">AddCECBlazorSPA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token function">AddApplicationServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> app<span class="token punctuation">,</span> <span class="token class-name">IWebHostEnvironment</span> env<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>env<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseDeveloperExceptionPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        app<span class="token punctuation">.</span><span class="token function">UseExceptionHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        app<span class="token punctuation">.</span><span class="token function">UseHsts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    app<span class="token punctuation">.</span><span class="token function">UseHttpsRedirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">UseBlazorFrameworkFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token function">UseStaticFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">UseRouting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token function">UseEndpoints</span><span class="token punctuation">(</span>endpoints <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapBlazorHub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapRazorPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapControllers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        endpoints<span class="token punctuation">.</span><span class="token function">MapFallbackToPage</span><span class="token punctuation">(</span><span class="token string">&quot;/_Host&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="servicecollectionextensions-cs-3"><a href="#servicecollectionextensions-cs-3" class="header-anchor">#</a> ServiceCollectionExtensions.cs</h4> <p>The site specific services are a singleton <code>IWeatherForecastDataService</code> interface loading either <code>WeatherForecastServerDataService</code> or <code>WeatherForecastDummyDataService</code>, a scoped <code>WeatherForecastControllerService</code> and a transient Fluent Validator service for the Editor.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">IServiceCollection</span> <span class="token function">AddApplicationServices</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IFactoryDataService<span class="token punctuation">&lt;</span>WeatherForecastDbContext<span class="token punctuation">&gt;</span><span class="token punctuation">,</span> WeatherDummyDataService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// services.AddSingleton&lt;IFactoryDataService&lt;WeatherForecastDbContext&gt;, FactoryServerDataService&lt;WeatherForecastDbContext&gt;&gt;();</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecastControllerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherStationControllerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddScoped</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherReportControllerService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Factory for building the DBContext </span>
    <span class="token class-name"><span class="token keyword">var</span></span> dbContext <span class="token operator">=</span> configuration<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;Configuration:DBContext&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddDbContextFactory</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WeatherForecastDbContext<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>options <span class="token operator">=&gt;</span> options<span class="token punctuation">.</span><span class="token function">UseSqlServer</span><span class="token punctuation">(</span>dbContext<span class="token punctuation">)</span><span class="token punctuation">,</span> ServiceLifetime<span class="token punctuation">.</span>Singleton<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> services<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="wrap-up"><a href="#wrap-up" class="header-anchor">#</a> Wrap Up</h2> <p>That wraps up this section.  It's a bit of an overview, with a lot more detail to come later.  Hopefully it demonstrates the level of abstraction you can achieve with Blazor projects.  The next section looks at Services and implementing the data layers.</p> <p>Some key points to note:</p> <ol><li>You can build your code so that almost all is common to both Server and WASM projects.  With care you can write an application that can be deployed either way as is the case with this project.</li> <li>Be very careful about the terminology.  We don't have &quot;Pages&quot; in the application.</li></ol> <h2 id="history"><a href="#history" class="header-anchor">#</a> History</h2> <ul><li>15-Sep-2020: Initial version</li> <li>17-Nov-2020: Major Blazor.CEC library changes.  Change to ViewManager from Router and new Component base implementation.</li> <li>7-Feb-2021: Major updates to Services, project structure and data editing</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/Building-a-Database-Application-in-Blazor/" class="prev router-link-active">
        Building a Database Application in Blazor
      </a></span> <span class="next"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html">
        Part 2 - Services - Building the CRUD Data Layers
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0784ea42.js" defer></script><script src="/assets/js/3.36dc20da.js" defer></script><script src="/assets/js/12.f7a15c90.js" defer></script>
  </body>
</html>
