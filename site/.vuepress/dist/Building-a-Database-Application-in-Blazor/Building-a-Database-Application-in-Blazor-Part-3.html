<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Part 3 - View Components - CRUD Edit and View Operations in the UI | Cold Elm Coders</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.87c9a490.css" as="style"><link rel="preload" href="/assets/js/app.e3bfb77f.js" as="script"><link rel="preload" href="/assets/js/3.5e2b9483.js" as="script"><link rel="preload" href="/assets/js/15.aa16269d.js" as="script"><link rel="prefetch" href="/assets/js/1.65b16415.js"><link rel="prefetch" href="/assets/js/10.b8a4f41e.js"><link rel="prefetch" href="/assets/js/11.24bdc204.js"><link rel="prefetch" href="/assets/js/12.6da04699.js"><link rel="prefetch" href="/assets/js/13.fdb80d52.js"><link rel="prefetch" href="/assets/js/14.19247647.js"><link rel="prefetch" href="/assets/js/16.e2eabcf4.js"><link rel="prefetch" href="/assets/js/17.a002f19b.js"><link rel="prefetch" href="/assets/js/18.c3946bff.js"><link rel="prefetch" href="/assets/js/19.d68e3171.js"><link rel="prefetch" href="/assets/js/20.e3743a94.js"><link rel="prefetch" href="/assets/js/21.8ed57a47.js"><link rel="prefetch" href="/assets/js/22.e937e782.js"><link rel="prefetch" href="/assets/js/23.6651a11b.js"><link rel="prefetch" href="/assets/js/24.763abe7c.js"><link rel="prefetch" href="/assets/js/25.e4637e58.js"><link rel="prefetch" href="/assets/js/26.46716480.js"><link rel="prefetch" href="/assets/js/27.93552137.js"><link rel="prefetch" href="/assets/js/28.1c69768b.js"><link rel="prefetch" href="/assets/js/29.ee18efb7.js"><link rel="prefetch" href="/assets/js/30.54f2feb4.js"><link rel="prefetch" href="/assets/js/31.e24b5fc9.js"><link rel="prefetch" href="/assets/js/32.20d63fc5.js"><link rel="prefetch" href="/assets/js/33.4a0e649b.js"><link rel="prefetch" href="/assets/js/34.fad49a48.js"><link rel="prefetch" href="/assets/js/35.99964307.js"><link rel="prefetch" href="/assets/js/36.c51263a3.js"><link rel="prefetch" href="/assets/js/37.6e36e751.js"><link rel="prefetch" href="/assets/js/38.de99cf55.js"><link rel="prefetch" href="/assets/js/39.5183ec6b.js"><link rel="prefetch" href="/assets/js/4.63142b85.js"><link rel="prefetch" href="/assets/js/40.4221bf56.js"><link rel="prefetch" href="/assets/js/41.d44dd28f.js"><link rel="prefetch" href="/assets/js/42.c3dbc38d.js"><link rel="prefetch" href="/assets/js/43.e103f5b7.js"><link rel="prefetch" href="/assets/js/5.340494e3.js"><link rel="prefetch" href="/assets/js/6.5fa8b292.js"><link rel="prefetch" href="/assets/js/7.d99bdfa4.js"><link rel="prefetch" href="/assets/js/8.b444bd43.js"><link rel="prefetch" href="/assets/js/9.0b541e03.js">
    <link rel="stylesheet" href="/assets/css/0.styles.87c9a490.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Cold Elm Coders</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link router-link-active">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/articles/" class="nav-link">
  Articles
</a></div><div class="nav-item"><a href="/posts/" class="nav-link">
  Posts
</a></div><div class="nav-item"><a href="/ArchivedArticles/" class="nav-link">
  Old Articles
</a></div><div class="nav-item"><a href="/Building-a-Database-Application-in-Blazor/" class="nav-link router-link-active">
  Database Application
</a></div><div class="nav-item"><a href="https://cec-blazor-examples.azurewebsites.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo Site
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Blazor Database Application</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Building-a-Database-Application-in-Blazor/" aria-current="page" class="sidebar-link">Building a Database Application in Blazor</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-1.html" class="sidebar-link">A Blazor Database Template - Project Structure and Framework</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html" class="sidebar-link">Building the Services</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html" aria-current="page" class="active sidebar-link">Part 3 - View Components - CRUD Edit and View Operations in the UI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#sample-project-and-code" class="sidebar-link">Sample Project and Code</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#the-base-forms" class="sidebar-link">The Base Forms</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#implementing-edit-components" class="sidebar-link">Implementing Edit Components</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#the-ui-components" class="sidebar-link">the UI Components</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#implementing-viewer-pages" class="sidebar-link">Implementing Viewer Pages</a></li><li class="sidebar-sub-header"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-3.html#history" class="sidebar-link">History</a></li></ul></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-4.html" class="sidebar-link">Part 4 - UI Components</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-5.html" class="sidebar-link">Part 5 - View Components - CRUD List Operations in the UI</a></li><li><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-6.html" class="sidebar-link">Part 6 - Adding new Record Types and Their UI to the Weather Application</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="part-3-view-components-crud-edit-and-view-operations-in-the-ui"><a href="#part-3-view-components-crud-edit-and-view-operations-in-the-ui" class="header-anchor">#</a> Part 3 - View Components - CRUD Edit and View Operations in the UI</h1> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>This article and all the others in this series is a building site.  Total revamp.  See CodeProject for the most recent released version which is very out-of-date</p></div> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This is the third in a series of articles looking at how to build and structure a real Database Application in Blazor. The articles so far are:</p> <ol><li>Project Structure and Framework.</li> <li>Services - Building the CRUD Data Layers.</li> <li>View Components - CRUD Edit and View Operations in the UI.</li> <li>UI Components - Building HTML/CSS Controls.</li> <li>View Components - CRUD List Operations in the UI.</li> <li>A walk through detailing how to add weather stations and weather station data to the application.</li></ol> <p>This article looks in detail at building reusable CRUD presentation layer components, specifically Edit and View functionality - and using them in Server and WASM projects.  There are significant changes since the first release.</p> <h2 id="sample-project-and-code"><a href="#sample-project-and-code" class="header-anchor">#</a> Sample Project and Code</h2> <p>The repository for the articles has moved to <a href="https://github.com/ShaunCurtis/CEC.Blazor.SPA" target="_blank" rel="noopener noreferrer">CEC.Blazor.SPA Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  <a href="https://github.com/ShaunCurtis/CEC.Blazor" target="_blank" rel="noopener noreferrer">CEC.Blazor GitHub Repository<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is obselete and will be removed.</p> <p>There's a SQL script in /SQL in the repository for building the database.</p> <p><a href="https://cec-blazor-server.azurewebsites.net/" target="_blank" rel="noopener noreferrer">You can see the Server and WASM versions of the project running here on the same site<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Serveral classes described here are part of the separate <em>CEC.Blazor.Core</em> library.  The Github is <a href="https://github.com/ShaunCurtis/CEC.Blazor.Core" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and is available as a Nuget Package.</p> <h2 id="the-base-forms"><a href="#the-base-forms" class="header-anchor">#</a> The Base Forms</h2> <p>All CRUD UI components inherit from <code>Component</code> - see the following article about <a href="https://www.codeproject.com/Articles/5277618/A-Dive-into-Blazor-Components" target="_blank" rel="noopener noreferrer">Component<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.  Not all the code is shown in the article: some class are simply too big to show everything.  All source files can be viewed on the Github site, and I include references or links to specific code files at appropriate places in the article.  Much of the information detail is in the comments in the code sections.</p> <h3 id="formbase"><a href="#formbase" class="header-anchor">#</a> FormBase</h3> <p><code>Formbase</code> is part of the <em>CEC.Blazor.Core</em> libary.</p> <p>All Forms inherit from <code>FormBase</code>.  <code>FormBase</code> provides the following functionality:</p> <ol><li>Replicates the code from <code>OwningComponentBase</code> to implement scoped service management.</li> <li>Gets the User if Authentication is enabled.</li> <li>Manages Form closure in Modal or Non-Modal state.</li> <li>Implements the <code>IForm</code> and <code>IDisposable</code> interfaces.</li></ol> <p>The scope management code looks like this.  You can search the Internet for articles on how to use <code>OwningComponentBase</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/Base/BaseForm.cs</span>
<span class="token keyword">private</span> <span class="token class-name">IServiceScope</span> _scope<span class="token punctuation">;</span>

<span class="token comment">/// Scope Factory to manage Scoped Services</span>
<span class="token punctuation">[</span>Inject<span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token return-type class-name">IServiceScopeFactory</span> ScopeFactory <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token operator">!</span><span class="token punctuation">;</span>

<span class="token comment">/// Gets the scoped IServiceProvider that is associated with this component.</span>
<span class="token keyword">protected</span> <span class="token return-type class-name">IServiceProvider</span> ScopedServices
<span class="token punctuation">{</span>
    <span class="token keyword">get</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ScopeFactory <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;Services cannot be accessed before the component is initialized.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>IsDisposed<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObjectDisposedException</span><span class="token punctuation">(</span><span class="token function">GetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _scope <span class="token operator">??=</span> ScopeFactory<span class="token punctuation">.</span><span class="token function">CreateScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> _scope<span class="token punctuation">.</span>ServiceProvider<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>IDisposable</code> interface implementation is tied in with scoped service management.  We'll use it later for removing event handlers.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDisposed <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/// IDisposable Interface</span>
<span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> IDisposable<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>IsDisposed<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _scope<span class="token punctuation">?.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _scope <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">disposing</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">DisposeAsync</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        IsDisposed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Dispose Method</span>
<span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> disposing<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token comment">/// Async Dispose event to clean up event handlers</span>
<span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">Task</span> <span class="token function">DisposeAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> disposing<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>

</code></pre></div><p>The rest of the properties are:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CascadingParameter</span></span><span class="token punctuation">]</span> <span class="token keyword">protected</span> <span class="token return-type class-name">IModal</span> ModalParent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/// Boolean Property to check if this component is in Modal Mode</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsModal <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ModalParent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">/// Cascaded Authentication State Task from CascadingAuthenticationState in App</span>
<span class="token punctuation">[</span>CascadingParameter<span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>AuthenticationState<span class="token punctuation">&gt;</span></span> AuthenticationStateTask <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/// Cascaded ViewManager </span>
<span class="token punctuation">[</span>CascadingParameter<span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">ViewManager</span> ViewManager <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/// Check if ViewManager exists</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsViewManager <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

<span class="token comment">/// Property holding the current user name</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CurrentUser <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">protected</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/// Guid string for user</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CurrentUserID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token comment">/// UserName without the domain name</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> CurrentUserName <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>CurrentUser<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>CurrentUser<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>CurrentUser<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>CurrentUser<span class="token punctuation">.</span><span class="token function">IndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>

</code></pre></div><p>The main event methods:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// OnRenderAsync Method from Component</span>
<span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span> <span class="token keyword">await</span> <span class="token function">GetUserAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/// Method to get the current user from the Authentication State</span>
<span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">GetUserAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>AuthenticationStateTask <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> state <span class="token operator">=</span> <span class="token keyword">await</span> AuthenticationStateTask<span class="token punctuation">;</span>
        <span class="token comment">// Get the current user</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>CurrentUser <span class="token operator">=</span> state<span class="token punctuation">.</span>User<span class="token punctuation">.</span>Identity<span class="token punctuation">.</span>Name<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> state<span class="token punctuation">.</span>User<span class="token punctuation">.</span>Claims<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>Type<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;nameidentifier&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>CurrentUserID <span class="token operator">=</span> x<span class="token punctuation">?.</span>Value <span class="token operator">??</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Finally, the exit button methods.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token class-name">ModalResult</span> result<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IsModal<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ModalParent<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span>LastViewData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IsModal<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ModalParent<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>ModalResult<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span>LastViewData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IsModal<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ModalParent<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>ModalResult<span class="token punctuation">.</span><span class="token function">Cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span>LastViewData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OK</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>IsModal<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ModalParent<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span>ModalResult<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">LoadViewAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span>LastViewData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="controllerserviceformbase"><a href="#controllerserviceformbase" class="header-anchor">#</a> ControllerServiceFormBase</h3> <p>At this point in the Form heirachy we add some complexity with generics.  We inject the Controller Service through the <code>IFactoryControllerService</code> interface, and we need to provide it with the RecordType we're loading <code>TRecord</code> and the DbContext to use <code>TContext</code>.  The class declaration apples the same contraints on the generics as <code>IFactoryControllerService</code>. The rest of the Properties are descibes in the code block.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/BaseForms/ControllerServiceFormBase.cs</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ControllerServiceFormBase<span class="token punctuation">&lt;</span>TRecord<span class="token punctuation">,</span> TContext<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span> 
        <span class="token type-list"><span class="token class-name">FormBase</span></span> 
        <span class="token keyword">where</span> <span class="token class-name">TRecord</span> <span class="token punctuation">:</span> <span class="token keyword">class</span><span class="token punctuation">,</span> IDbRecord<span class="token operator">&lt;</span>TRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">where</span> <span class="token class-name">TContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// Controller Service for Type TRecord</span>
        <span class="token comment">/// Normally set as the first line in the OnRender event.</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IFactoryControllerService<span class="token punctuation">&lt;</span>TRecord<span class="token punctuation">,</span> TContext<span class="token punctuation">&gt;</span></span> Service <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">/// Property Collection to control various UI Settings</span>
        <span class="token comment">/// Cascaded by control</span>
        <span class="token punctuation">[</span>Parameter<span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">PropertyCollection</span> Properties <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">PropertyCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// The default alert used by all inherited components</span>
        <span class="token comment">/// Used for Editor Alerts, error messages, ....</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">Alert</span> AlertMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/// Property with generic error message for the Page Manager </span>
        <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> RecordErrorMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">&quot;The Application is loading the record.&quot;</span><span class="token punctuation">;</span>

        <span class="token comment">/// Boolean check if the Service exists</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsService <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="recordformbase"><a href="#recordformbase" class="header-anchor">#</a> RecordFormBase</h3> <p>This form is used directly by all the record display forms.  It introduces record management.  <code>RecordFormBase</code> holds the ID and makes the calls to the Record Service to load and reset the record.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/Base/RecordFormBase.cs</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecordFormBase<span class="token punctuation">&lt;</span>TRecord<span class="token punctuation">,</span> TContext<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">ControllerServiceFormBase<span class="token punctuation">&lt;</span>TRecord<span class="token punctuation">,</span> TContext<span class="token punctuation">&gt;</span></span></span>
    <span class="token keyword">where</span> <span class="token class-name">TRecord</span> <span class="token punctuation">:</span> <span class="token keyword">class</span><span class="token punctuation">,</span> IDbRecord<span class="token operator">&lt;</span>TRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">where</span> <span class="token class-name">TContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">/// This Page/Component Title</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PageTitle <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">?.</span>Record<span class="token punctuation">?.</span>DisplayName <span class="token operator">??</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// Boolean Property that checks if a record exists</span>
    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsRecord <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">?.</span>IsRecord <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token comment">/// Used to determine if the page can display data</span>
    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsError <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsRecord<span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">/// Used to determine if the page has display data i.e. it's not loading or in error</span>
    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLoaded <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Loading<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsError<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// Property for the Record ID</span>
    <span class="token punctuation">[</span>Parameter<span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> ID
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_ID<span class="token punctuation">;</span>
        <span class="token keyword">set</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_ID <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">value</span> <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token keyword">value</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// No Null Version of the ID</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> _ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// On first load reset the Service record to make sure we're clean</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsService<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">ResetRecordAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Set up the Record Changed event to trigger a render event on the component</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>RecordHasChanged <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>OnRecordChangedAsync<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Load the Record</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  Call down the hierachy</span>
        <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Event handler that triggers a page render</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Render_Async</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// Reloads the record if the ID has changed</span>
    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstload <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsService<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Set the Loading flag </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>setLoading<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token comment">//  call Render only if we are responding to an event.  In the component loading cycle it will be called for us shortly</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstload<span class="token punctuation">)</span> <span class="token keyword">await</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsModal <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span>ModalDialog<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">object</span></span> modalid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ID <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>modalid <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">?</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>modalid <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ID<span class="token punctuation">;</span>

            <span class="token comment">// Get the current record - this will check if the id is different from the current record and only update if it's changed</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">GetRecordAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_ID<span class="token punctuation">,</span> firstload<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//if (this._ID == 0 &amp;&amp; firstload) await this.Service.SetToNewRecordAsync();</span>
            <span class="token comment">//else await this.Service.GetRecordAsync(this._ID, firstload);</span>

            <span class="token comment">// Set the error message - it will only be displayed if we have an error</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordErrorMessage <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;The Application can't load the Record with ID: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">this</span><span class="token punctuation">.</span>_ID</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>

            <span class="token comment">// Set the Loading flag</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>setLoading<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">//  call Render only if we are responding to an event.  In the component loading cycle it will be called for us shortly</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstload<span class="token punctuation">)</span> <span class="token keyword">await</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// OnRecordChanged Event Handler</span>
    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnRecordChangedAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Disposer - unhooks wired events</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> disposing<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsService<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>RecordHasChanged <span class="token operator">-=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>OnRecordChangedAsync<span class="token punctuation">;</span>
        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span>disposing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="editrecordformbase"><a href="#editrecordformbase" class="header-anchor">#</a> EditRecordFormBase</h3> <p>This is the base for editor forms.  It:</p> <ol><li>Manages the <code>EditContext</code>.  We don't use the standard <code>EditForm</code>.  the local <code>EditContext</code> is built from the <code>IRecordEditContext</code> property.</li> <li>Has a set of Boolean Properties to keep the UI clean.  I code any UI test statements into properties.</li> <li>Manages the Form state based on the record state.  It locks the page in the application when the state is dirty and blocks browser navigation through the browser navigation challenge.</li> <li>Saves the record.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/Base/EditRecordFormBase.cs</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">EditRecordFormBase<span class="token punctuation">&lt;</span>TRecord<span class="token punctuation">,</span> TDbContext<span class="token punctuation">&gt;</span></span> <span class="token punctuation">:</span>
        <span class="token type-list"><span class="token class-name">RecordFormBase<span class="token punctuation">&lt;</span>TRecord<span class="token punctuation">,</span> TDbContext<span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">where</span> <span class="token class-name">TRecord</span> <span class="token punctuation">:</span> <span class="token keyword">class</span><span class="token punctuation">,</span> IDbRecord<span class="token operator">&lt;</span>TRecord<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">where</span> <span class="token class-name">TDbContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
    <span class="token punctuation">{</span>
        <span class="token preprocessor property">#<span class="token directive keyword">region</span> Public Properties</span>

        <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span> <span class="token operator">=&gt;</span> _EditContext<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PageTitle
        <span class="token punctuation">{</span>
            <span class="token keyword">get</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsNewRecord<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$&quot;New </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">?.</span>RecordInfo<span class="token punctuation">?.</span>RecordDescription <span class="token operator">??</span> <span class="token string">&quot;Record&quot;</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">?.</span>RecordInfo<span class="token punctuation">?.</span>RecordDescription <span class="token operator">??</span> <span class="token string">&quot;Record&quot;</span></span><span class="token punctuation">}</span></span><span class="token string"> Editor&quot;</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// a set of state properties to keep the UI clean</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsClean <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">?.</span>IsClean <span class="token operator">??</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">?.</span>IsDirty <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValidated <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">?.</span>IsValid <span class="token operator">??</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsError <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsNewRecord <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">?.</span>RecordID <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">?</span> <span class="token boolean">true</span> <span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name">IRecordEditContext</span> RecordEditorContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token class-name">EditContext</span> _EditContext <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token comment">// overridden LoadRecord Method</span>
        <span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstLoad <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> setLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span>firstLoad<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>firstLoad<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>_EditContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EditContext</span><span class="token punctuation">(</span>RecordEditorContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span><span class="token function">NotifyEditContextChangedAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span>OnFieldChanged <span class="token operator">+=</span> onFieldChanged<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// Event handler for EditContext OnFieldChanged</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">onFieldChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// Save Method called from the Save Button</span>
        <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> ok <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token comment">// Validate the EditContext</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Save the Record</span>
                ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">SaveRecordAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">// Set the EditContext State</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">MarkAsUnmodified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Set the View Lock i.e. unlock it</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// Set the alert message to the return result</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">SetAlert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>TaskResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Trigger a component State update - buttons and alert need to be sorted</span>
                <span class="token keyword">await</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">SetAlert</span><span class="token punctuation">(</span><span class="token string">&quot;A validation error occurred.  Check individual fields for the relevant error.&quot;</span><span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Danger<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ok<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SaveAndExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">ConfirmExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">TryExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Check if we are free to exit ot need confirmation</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsClean<span class="token punctuation">)</span> <span class="token function">ConfirmExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfirmExit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// To escape a dirty component reset the Record Collection and unlock the View</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>RecordValueCollection<span class="token punctuation">.</span><span class="token function">ResetValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnValidationStateChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">ValidationStateChangedEventArgs</span> e<span class="token punctuation">)</span> 
            <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>RecordValueCollection<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">LockView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">SetAlert</span><span class="token punctuation">(</span><span class="token string">&quot;The Record isn't Saved&quot;</span><span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Warning<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">UnLockView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">ClearAlert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="implementing-edit-components"><a href="#implementing-edit-components" class="header-anchor">#</a> Implementing Edit Components</h2> <p>Before we look at the edit componments we need to take a sep back and look at the <code>Model</code> we'll use.  In Article 2 we looked at our data class <code>DbWeatherForecast</code> and saw the code for creating a <code>RecordCollection</code> from the data class and building a new <code>DbWeatherForecast</code> record from a <code>RecordCollection</code>.  Remember the properties in a <code>DbWeatherForecast</code> as immutable - they are declared <code>{get; init;}</code>.  The <code>RecordCollection</code> for a record is the editable copy of that record.  We don't create a simple edit version of <code>DbWeatherForecast</code>, or a simple <code>Dictionary</code> object because we want a build in a lot more functionality.</p> <h4 id="recordfieldvalue"><a href="#recordfieldvalue" class="header-anchor">#</a> RecordFieldValue</h4> <p>a <code>RecordFieldValue</code> represents an editable version of a database record field.</p> <p>Note:</p> <ol><li>There's <code>Value</code> and <code>EditedValue</code> properties to keep track of the edit state of the field.</li> <li><code>IsDirty</code>  is a readonly property use to check the edit state.</li> <li><code>Reset</code> sets <code>EditedValue</code> back to <code>Value</code>.</li> <li><code>Guid</code> provides uniqueness.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecordFieldValue</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Field <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">Guid</span> GUID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> EditedValue <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> EditedValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">!</span>Value<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>EditedValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>Value <span class="token keyword">is</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> EditedValue <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// setter methods</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditedValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="recordcollection"><a href="#recordcollection" class="header-anchor">#</a> RecordCollection</h4> <p>A <code>RecordCollection</code> is a collection of <code>RecordFieldValue</code> objects used to store record fields.  It:</p> <ol><li>Implements <code>ICollection</code> - a lot of the functionality is the interface implementation.</li> <li>Provides controlled access to the underlying list and methods to get and set <code>RecordFieldValue</code> objects.</li> <li>As <code>RecordFieldValue.Value</code> is defined as an object, generics are used to get values from a <code>RecordFieldValue</code> object.</li> <li><code>IsDirty</code> tests all the <code>RecordFieldValue</code> objects in the list to check if the collection <code>IsDirty</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RecordCollection</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICollection</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>RecordFieldValue<span class="token punctuation">&gt;</span></span> _items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>RecordFieldValue<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Count <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span>Count<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsSynchronized <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> SyncRoot <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> FieldValueChanged<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span><span class="token function">Any</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ResetValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _items<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerator</span> <span class="token function">GetEnumerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordCollectionEnumerator</span><span class="token punctuation">(</span>_items<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SetField</span><span class="token punctuation">(</span><span class="token class-name">RecordFieldInfo</span> field<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">SetField</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> FieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> _items<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>Field<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>CurrentCultureIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> <span class="token keyword">default</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            x<span class="token punctuation">.</span>EditedValue <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>FieldValueChanged<span class="token punctuation">?.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> _items<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordFieldValue</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
        
    <span class="token comment">// a whole host of methods for getting and setting, adding and deleting Record Values </span>
    <span class="token keyword">public</span> <span class="token return-type class-name">T</span> <span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> FieldName<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> x <span class="token operator">=</span> _items<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>Field<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span>FieldName<span class="token punctuation">,</span> StringComparison<span class="token punctuation">.</span>CurrentCultureIgnoreCase<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">.</span>EditedValue <span class="token keyword">is</span> <span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token keyword">return</span> t<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token range operator">..</span><span class="token range operator">..</span><span class="token range operator">..</span> 
<span class="token comment">// Enumerator code</span>
</code></pre></div><h3 id="the-recordeditcontext"><a href="#the-recordeditcontext" class="header-anchor">#</a> The RecordEditContext</h3> <p><code>RecordEditContext</code> is the final bit of the data record jigsaw.  The <code>RecordEditContext</code> is the <code>Model</code> for the edit form and <code>EditContext</code> and what the <code>InputBase</code> fields are wired into.  <code>RecordEditContext</code> is the glue for the editing process, it:</p> <ol><li>Manages the edit state and exposes that state in <code>IsClean</code> and <code>IsDirty</code>.</li> <li>Mananges the load state and exposes that state through <code>IsLoaded</code>.</li> <li>Manages the validation process and state and exposes that state through <code>IsValid</code>.</li> <li>Exposes the edit fields through properties.</li></ol> <h3 id="irecordeditcontext"><a href="#irecordeditcontext" class="header-anchor">#</a> IRecordEditContext</h3> <p>First we have an interface <code>IRecordEditContext</code>.  The properties and methods are self-evident.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRecordEditContext</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValid <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsClean <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLoaded <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">NotifyEditContextChangedAsync</span><span class="token punctuation">(</span><span class="token class-name">EditContext</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="recordeditcontext"><a href="#recordeditcontext" class="header-anchor">#</a> RecordEditContext</h3> <p><code>RecordEditContext</code> is the base implementation for any record.  It contains the common boilerplate code.</p> <p>The properties and fields are shown below:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RecordEditContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IRecordEditContext</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValid <span class="token operator">=&gt;</span> <span class="token operator">!</span>Trip<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsDirty <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">?.</span>IsDirty <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsClean <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsDirty<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLoaded <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token return-type class-name">RecordCollection</span> RecordValues <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RecordCollection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name"><span class="token keyword">bool</span></span> Trip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> ValidationActions <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Func<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">ValidationMessageStore</span> ValidationMessageStore<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> Validating<span class="token punctuation">;</span>

</code></pre></div><p>The class is initialised by passing it a RecordCollection.  <code>null</code> is not allowed.  The initialisation method also calls <code>LoadValidationActions</code> which populates the <code>ValidationActions</code> property.  The method prototype does nothing, but in a record implementation <code>ValidationActions</code> is a <code>Func</code> delegate that holds the validation functions for the record.  We'll see some of these when we look at <code>WaetherForecastEditContext</code>.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token function">RecordEditContext</span><span class="token punctuation">(</span><span class="token class-name">RecordCollection</span> collection<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Debug<span class="token punctuation">.</span><span class="token function">Assert</span><span class="token punctuation">(</span>collection <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>collection <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RecordEditContext<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> requires a valid </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RecordCollection<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> object&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues <span class="token operator">=</span> collection<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LoadValidationActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadValidationActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><p><code>NotifyEditContextChangedAsync</code> is called by the editor form when the <code>EditContext</code> is changed.  This will normally only be called during the iinitial rendering process.  It:</p> <ol><li>Will error on being passed a <code>null</code>.</li> <li>Disconnects wiring to the old <code>EditContext</code> if one existed.</li> <li>Sets it's <code>EditContext</code> to the new one.</li> <li>Creates a new <code>ValidationMessageStore</code> object from the new <code>EditContext</code>.</li> <li>Wires up to the <code>EditContext.OnValidationRequested</code> event to <code>ValidationRequested</code>.</li> <li>Calls <code>Validate</code> on the current object to set the initial validation state.</li></ol> <p><code>RecordEditContext</code> is now wired into the form edit controls through the <code>EditContext</code>.  We don't wire into the  <code>OnFieldChanged</code> event because we keep our own track of edit state.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token keyword">public</span> <span class="token return-type class-name">Task</span> <span class="token function">NotifyEditContextChangedAsync</span><span class="token punctuation">(</span><span class="token class-name">EditContext</span> context<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> oldcontext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token keyword">is</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>RecordEditContext<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> - NotifyEditContextChangedAsync requires a valid </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">nameof</span><span class="token punctuation">(</span>EditContext<span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string"> object&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// if we already have an edit context, we will have registered with OnValidationRequested, so we need to drop it before losing our reference to the editcontext object.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>EditContext <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                EditContext<span class="token punctuation">.</span>OnValidationRequested <span class="token operator">-=</span> ValidationRequested<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// assign the Edit Context internally</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsLoaded<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">// Get the Validation Message Store from the EditContext</span>
                ValidationMessageStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ValidationMessageStore</span><span class="token punctuation">(</span>EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Wire up to the Editcontext to service Validation Requests</span>
                EditContext<span class="token punctuation">.</span>OnValidationRequested <span class="token operator">+=</span> ValidationRequested<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Call a validation on the current data set</span>
            <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre></div><p>The Validation process is either triggered manually by calling <code>Validate</code> or by the <code>EditContext</code> triggering <code>OnValidationRequested</code>.  The validation process:</p> <ol><li>Checks the <code>ValidationMessageStore</code> and the <code>Validating</code> flag.  We don't want to fire one validation while another is already running.</li> <li>Clears the <code>ValidationMessageStore</code>.  As the <code>ValidationMessageStore</code> is wired into the <code>EditContext</code> it actually clears the messages from <code>EditContext</code>.</li> <li>Sets the tripwire <code>Trip</code>.</li> <li>Loops through and invokes each validator, tripping the tripwire if the validator doesn't return true.</li> <li>Calls <code>NotifyValidationStateChanged</code> on the <code>EditContext</code> to cascade the new validation.</li> <li>Resets <code>Validating</code>.</li></ol> <p>The important bit here is the interconnect between <code>RecordEditContext</code> and <code>EditContext</code>.  The input fields and validation messages on the edit form are all wired up to the <code>EditContext</code> and will update when the validation changes.</p> <blockquote><p>If UI fields don't &quot;light up&quot; when they're invalid, you almost certainly have a naming issue in the <code>FieldName</code> used in <code>FieldIdentifiers</code>.</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code>        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">ValidationRequested</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> ValidationRequestedEventArgs<span class="token punctuation">.</span>Empty<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> IsValid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ValidationRequested</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">ValidationRequestedEventArgs</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// using Validating to stop being called multiple times</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ValidationMessageStore <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>Validating<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Validating <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token comment">// clear the message store and trip wire and check we have Validators to run</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Trip <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> validator <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                EditContext<span class="token punctuation">.</span><span class="token function">NotifyValidationStateChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>Validating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>Moving on to a real <code>RecordEditContext</code> implementation -  <code>WeatherForecastEditContext</code>.  The code below is a shortened version of <code>WeatherForecastEditContext</code>.  Most of the properties and validators have been removed.</p> <ol><li>There's a public Property for all the fields used in the editor form.  The <code>getter</code> gets the field from the underlying <code>RecordCollection</code> and the setter calls <code>SetField</code> in the <code>RecordCollection</code>.</li> <li>The setter calls <code>Validate</code> on fields that require validation.</li> <li>ReadOnly fields only have a getter.</li> <li><code>LoadValidationActions</code> loads the validators on initialisation.</li> <li>Validators are declared as private, they are specific to this implementation.  There's one Validator for each field that requires validating.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastEditContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RecordEditContext</span><span class="token punctuation">,</span> <span class="token class-name">IRecordEditContext</span></span>
<span class="token punctuation">{</span>
    <span class="token comment">// Example public Edit Property with Validation</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> WeatherForecastDate
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastDate<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Example public Edit Property without Validation</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> WeatherForecastOutlookValue
    <span class="token punctuation">{</span>
        <span class="token keyword">get</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastOutlookValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">set</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token function">SetField</span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastOutlookValue<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Example public read only Property used for diplay purposes only</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> WeatherForecastID
        <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordValues<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetEditValue</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastID<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">WeatherForecastEditContext</span><span class="token punctuation">(</span><span class="token class-name">RecordCollection</span> collection<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>collection<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token comment">// loader loading all the validators - LoadValidationActions is run by the base new</span>
    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LoadValidationActions</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidateDescription<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidateTemperatureC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidateDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationActions<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>ValidatePostCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Example Validator - this one uses a Regex</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidatePostCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastPostCode<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastPostCode<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ValidationMessageStore<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Matches</span><span class="token punctuation">(</span><span class="token string">@&quot;^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token string">&quot;You must enter a Post Code (e.g. GL52 8BX)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Example Validator - this one checks the date is withon bounds.  Note the specific messages for each fault condition</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidateDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastDate<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastDate<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ValidationMessageStore<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">NotDefault</span><span class="token punctuation">(</span><span class="token string">&quot;You must select a date&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddMonths</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;Date can only be up to 1 month ahead&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let's look at the Date Validator in more detail.</p> <h4 id="validator"><a href="#validator" class="header-anchor">#</a> Validator</h4> <p><code>Validator</code> is the base class for all validators and provides the common boilerplate functionality.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Validator<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsValid <span class="token operator">=&gt;</span> <span class="token operator">!</span>Trip<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> Trip <span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> Messages <span class="token punctuation">{</span><span class="token keyword">get</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FieldName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name">T</span> Value <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> DefaultMessage <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token string">&quot;The value failed validation&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name">ValidationMessageStore</span> ValidationMessageStore <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Model <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

        <span class="token comment">// New called by the extension method for the specific validator</span>
        <span class="token keyword">public</span> <span class="token function">Validator</span><span class="token punctuation">(</span><span class="token class-name">T</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> model<span class="token punctuation">,</span> <span class="token class-name">ValidationMessageStore</span> validationMessageStore<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName <span class="token operator">=</span> fieldName<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Model <span class="token operator">=</span> model<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore <span class="token operator">=</span> validationMessageStore<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>DefaultMessage <span class="token operator">=</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token punctuation">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DefaultMessage <span class="token punctuation">:</span> message<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// final chain method called that returns a bool and updates the ValidationMessageStore</span>
        <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Validate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                message <span class="token operator">??=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>DefaultMessage<span class="token punctuation">;</span>
                <span class="token comment">// Check if we've logged specific messages.  If not add the default message</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Messages<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//set up a FieldIdentifier and add the message to the Edit Context ValidationMessageStore</span>
                <span class="token class-name"><span class="token keyword">var</span></span> fi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">FieldIdentifier</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Model<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>FieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>ValidationMessageStore<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>fi<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Messages<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsValid<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">LogMessage</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><code>DateTimeValidator</code> is the validator for <code>DateTime</code> fields.</p> <ol><li>The initialiser gets passed the <code>ValidationMessageStore</code> so it can log the validation result directly to the store.  You can see that happening in <code>Validate</code> on the base class.  It needs the <code>Model</code> and the <code>FieldName</code> to associate the entry with the correct field.  Get the field name wrong and the field input control won't turn red, and the message won't appear!</li> <li>The Value is the actual field value is passed in as <code>value</code>.</li> <li>The validation error message can be set at various points.</li> <li>Each validator method returns the validator object, so you can chain validation methods together.</li> <li>Calling <code>Validate</code> completes the validation, logging any errors to the <code>ValidationMessageStore</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeValidator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Validator<span class="token punctuation">&lt;</span>DateTime<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">DateTimeValidator</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> model<span class="token punctuation">,</span> <span class="token class-name">ValidationMessageStore</span> validationMessageStore<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> fieldName<span class="token punctuation">,</span> model<span class="token punctuation">,</span> validationMessageStore<span class="token punctuation">,</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token return-type class-name">DateTimeValidator</span> <span class="token function">LessThan</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> test<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> dateOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dateOnly<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>Value<span class="token punctuation">.</span>Date <span class="token operator">&lt;</span> test<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">&lt;</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DateTimeValidator</span> <span class="token function">GreaterThan</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> test<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> dateOnly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dateOnly<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>Value<span class="token punctuation">.</span>Date <span class="token operator">&gt;</span> test<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">&gt;</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">DateTimeValidator</span> <span class="token function">NotDefault</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Value <span class="token operator">==</span> <span class="token keyword">default</span><span class="token punctuation">(</span><span class="token type-expression class-name">DateTime</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">LogMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>DateTimeValidatorExtensions</code> defines <code>Validation</code> as a extension to the <code>DateTime</code> type.  It's arguments are the same as the initialiser for the validator and it returns a <code>DateTimeValidator</code> object.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DateTimeValidatorExtensions</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DateTimeValidator</span> <span class="token function">Validation</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">DateTime</span> <span class="token keyword">value</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> fieldName<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">object</span></span> model<span class="token punctuation">,</span> <span class="token class-name">ValidationMessageStore</span> validationMessageStore<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> validation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DateTimeValidator</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">,</span> fieldName<span class="token punctuation">,</span> model<span class="token punctuation">,</span> validationMessageStore<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> validation<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To Implement a validator on a <code>DateTime</code> field, call the extension <code>Validation</code> with the correct arguments returns the validator.  The validation methods can thern be chained - each has a different message which gets logged to the internal message store if tripped.  The final call to <code>Validate</code> completes the process, adding any messages to the <code>ValidationMessageStore</code>, and returns true of false.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">ValidateDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastDate<span class="token punctuation">.</span><span class="token function">Validation</span><span class="token punctuation">(</span>DataDictionary<span class="token punctuation">.</span>__WeatherForecastDate<span class="token punctuation">.</span>FieldName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> ValidationMessageStore<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">NotDefault</span><span class="token punctuation">(</span><span class="token string">&quot;You must select a date&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">LessThan</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span><span class="token function">AddMonths</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;Date can only be up to 1 month ahead&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Creating custom validation methods is a simple case of creating an extension method on the correct validator and following the pattern:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name">xxxValidator</span> <span class="token function">MethodName</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token class-name">xxxValidator</span> validator<span class="token punctuation">,</span> <span class="token class-name">your</span> arguments<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// if fails</span>
    validator<span class="token punctuation">.</span>Trip <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span> validator<span class="token punctuation">.</span>Messages<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> validator<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let's now move on to the UI components.</p> <h2 id="the-ui-components"><a href="#the-ui-components" class="header-anchor">#</a> the UI Components</h2> <p>All the Forms and Views are implemented in the <code>CEC.Weather</code> library.</p> <h3 id="the-view"><a href="#the-view" class="header-anchor">#</a> The View</h3> <p>The View is a very simple. It:</p> <ol><li>Sets the inheritance to <code>ViewBase</code> which implments <code>IView</code>.</li> <li>Declares an <code>ID</code> Parameter which is passed to <code>WeatherForecastEditorForm</code></li> <li>Adds a <code>WeatherForecastEditorForm</code> component to the view.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Weather/Components/Views/WeatherForecastEditorView.razor</span>
@inherits Component
@implements IView

@<span class="token keyword">namespace</span> CEC<span class="token punctuation">.</span>Weather<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Views

<span class="token operator">&lt;</span><span class="token class-name">WeatherForecastEditorForm</span> ID<span class="token operator">=</span><span class="token string">&quot;this.ID&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>WeatherForecastEditorForm<span class="token operator">&gt;</span>

@code <span class="token punctuation">{</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">CascadingParameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">ViewManager</span> ViewManager <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="modaleditform"><a href="#modaleditform" class="header-anchor">#</a> ModalEditForm</h4> <p>The final component to look at before we look at <code>WeatherForecastEditorForm</code> is <code>ModalEditForm</code>.  This replaces <code>Editform</code>.  It's a lot simpler, managing the render process to only show the edit components when the data, edit context and RecordEditContext are loaded.  It also cascades the <code>EditContext</code> to the input controls.</p> <ol><li>There are four <code>RenderFragments</code> which are self-evident.</li> <li><code>Isloaded</code> and <code>IsError</code> control which <code>RenderFragments</code> get rendered.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModalEditForm</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Component</span></span>
<span class="token punctuation">{</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> EditorContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> ButtonContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> LoadingContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">RenderFragment</span> ErrorContent <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsLoaded <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsError <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name">EditContext</span> EditContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">BuildRenderTree</span><span class="token punctuation">(</span><span class="token class-name">RenderTreeBuilder</span> builder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//Debug.Assert(EditContext != null);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsLoaded<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// If EditContext changes, tear down and recreate all descendants.</span>
            <span class="token comment">// This is so we can safely use the IsFixed optimization on CascadingValue,</span>
            <span class="token comment">// optimizing for the common case where EditContext never changes.</span>
            builder<span class="token punctuation">.</span><span class="token function">OpenRegion</span><span class="token punctuation">(</span>EditContext<span class="token punctuation">.</span><span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">OpenComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CascadingValue<span class="token punctuation">&lt;</span>EditContext<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;IsFixed&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">AddAttribute</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;ChildContent&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>EditorContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">CloseComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            builder<span class="token punctuation">.</span><span class="token function">CloseRegion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsError<span class="token punctuation">)</span>
            builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ErrorContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>LoadingContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder<span class="token punctuation">.</span><span class="token function">AddContent</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ButtonContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="the-form"><a href="#the-form" class="header-anchor">#</a> The Form</h3> <p>The code file is relatively simple, with most of the detail in the razor markup. It:</p> <ol><li>Declares the class and inheritance defining <code>TRecord</code> and <code>TDbContext</code>.</li> <li>Injects the correct Controller Service and assigns the controller service to <code>Service</code>.</li> <li>Creates a WeatherForecastEditorContext instance and assigns it to <code>RecordEditorContext</code>.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Weather/Components/Forms/WeatherForecastEditorForm.razor</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastEditorForm</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">EditRecordFormBase<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">,</span> WeatherForecastDbContext<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Inject</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">WeatherForecastControllerService</span> ControllerService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token return-type class-name">WeatherForecastEditContext</span> WeatherForecastEditorContext <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Service <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastEditorContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherForecastEditContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">.</span>RecordValueCollection<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastEditorContext<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The Razor Markup below is an abbreviated version of the full file.  This makes extensive use of UIControls which will be covered in detail in the next article.  See the comments for detail.  The import concept to note here is the Razor Markup is all Controls - there's no HTML in sight.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Weather/Components/Forms/WeatherForecastEditorForm.razor.cs</span>
<span class="token comment">// UI Card is a Bootstrap Card</span>
<span class="token operator">&lt;</span><span class="token class-name">UICard</span> IsCollapsible<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Header<span class="token operator">&gt;</span>
        @<span class="token keyword">this</span><span class="token punctuation">.</span>PageTitle
    <span class="token operator">&lt;</span><span class="token operator">/</span>Header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Body<span class="token operator">&gt;</span>
        <span class="token comment">// Handles errors and controls when the enclosed code is rendered</span>
        <span class="token operator">&lt;</span><span class="token class-name">ModalEditForm</span> EditContext<span class="token operator">=</span><span class="token string">&quot;this.EditContext&quot;</span> IsError<span class="token operator">=</span><span class="token string">&quot;this.IsError&quot;</span> IsLoaded<span class="token operator">=</span><span class="token string">&quot;this.IsLoaded&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>ErrorContent<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>UIContainer<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>UIRow<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>UIColumn<span class="token operator">&gt;</span>
                            @<span class="token keyword">this</span><span class="token punctuation">.</span>RecordErrorMessage
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIRow<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>UIContainer<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ErrorContent<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>LoadingContent<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>UILoading<span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>LoadingContent<span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>EditorContent<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>UIContainer<span class="token operator">&gt;</span>
                    <span class="token comment">// Example display only row</span>
                    <span class="token operator">&lt;</span>UIFormRow<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UILabelColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token operator">&gt;</span>
                            <span class="token class-name">Record</span> ID<span class="token punctuation">:</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UILabelColumn<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">InputReadOnlyText</span> Value<span class="token operator">=</span><span class="token string">&quot;@this.WeatherForecastEditorContext.WeatherForecastID.ToString()&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>InputReadOnlyText<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIFormRow<span class="token operator">&gt;</span>

                    <span class="token comment">// Example data value row with label and edit control</span>
                    <span class="token operator">&lt;</span>UIFormRow<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UILabelColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token operator">&gt;</span>
                            <span class="token class-name">Record</span> Date<span class="token punctuation">:</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UILabelColumn<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;4&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span>InputDate <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span> @bind<span class="token operator">-</span>Value<span class="token operator">=</span><span class="token string">&quot;this.WeatherForecastEditorContext.WeatherForecastDate&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>InputDate<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIFormRow<span class="token operator">&gt;</span>
                    <span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token comment">// more form rows here</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>UIContainer<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>EditorContent<span class="token operator">&gt;</span>

            <span class="token comment">// always displayed section of the ErrorHandler.  Exit button to exit the form no matter what happens</span>
            <span class="token operator">&lt;</span>ButtonContent<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span>UIContainer<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>UIRow<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;7&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">UIAlert</span> Alert<span class="token operator">=</span><span class="token string">&quot;this.AlertMessage&quot;</span> SizeCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.SizeCode.sm&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>UIAlert<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UIButtonColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;5&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Disabled<span class="token operator">=</span><span class="token string">&quot;!this.DisplaySave&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;this.SaveAndExit&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.save&quot;</span><span class="token operator">&gt;</span>@<span class="token keyword">this</span><span class="token punctuation">.</span>SaveButtonText <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> Exit<span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Disabled<span class="token operator">=</span><span class="token string">&quot;!this.DisplaySave&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;this.Save&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.save&quot;</span><span class="token operator">&gt;</span>@<span class="token keyword">this</span><span class="token punctuation">.</span>SaveButtonText<span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Show<span class="token operator">=</span><span class="token string">&quot;this.DisplayCheckExit&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;this.ConfirmExit&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.danger_exit&quot;</span><span class="token operator">&gt;</span>Exit Without Saving<span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Show<span class="token operator">=</span><span class="token string">&quot;this.DisplayExit&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;this.TryExit&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.nav&quot;</span><span class="token operator">&gt;</span>Exit<span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIButtonColumn<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIRow<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>UIContainer<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ButtonContent<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ModalEditForm<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UICard<span class="token operator">&gt;</span>
</code></pre></div><h3 id="form-event-code"><a href="#form-event-code" class="header-anchor">#</a> Form Event Code</h3> <p>Let's take a look at how all this code wires up.</p> <h4 id="component-event-code"><a href="#component-event-code" class="header-anchor">#</a> Component Event Code</h4> <p>Start with <code>OnRenderAsync</code>.</p> <h5 id="oninitializedasync"><a href="#oninitializedasync" class="header-anchor">#</a> OnInitializedAsync</h5> <p><code>OnRenderAsync</code> is implemented from top down (local code is run before calling the base method).  It:</p> <ol><li>Assigns the right data service to <code>Service</code>.</li> <li>Creates the <code>WeatherForecastEditorContext</code> instance and assigns it to the Interface property.</li> <li>Resets the Record.</li> <li>Wires up <code>OnRecordChangedAsync</code> to the service event.</li> <li>Loads the record through <code>LoadRecordAsync</code>.</li> <li>Gets The user information.</li></ol> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Weather/Components/Forms/WeatherEditorForm.razor.cs</span>
<span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Service <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastEditorContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherForecastEditContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">.</span>RecordValueCollection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WeatherForecastEditorContext<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// CEC.Blazor/Components/BaseForms/RecordFormBase.cs</span>
<span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>IsService<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">ResetRecordAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>RecordHasChanged <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>OnRecordChangedAsync<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// CEC.Blazor/Components/BaseForms/ApplicationComponentBase.cs</span>
<span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">GetUserAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="loadrecordasync"><a href="#loadrecordasync" class="header-anchor">#</a> LoadRecordAsync</h5> <p>Record loading code is broken out so it can be used outside the component event driven methods.  It's implemented from bottom up (base method is called before any local code).</p> <p>The primary record load functionaility is in <code>RecordFormBase</code> which gets and loads the record based on ID.  <code>EditFormBase</code> adds the extra editing functionality - it creates the edit context for the record.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/BaseForms/RecordComponentBase.cs</span>
<span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstload <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> setLoading <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsService<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set the Loading flag </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>setLoading<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">//  call Render only if we are not responding to first load</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstload<span class="token punctuation">)</span> <span class="token keyword">await</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>IsModal <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span>ModalDialog<span class="token punctuation">.</span>Options<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">TryGetValue</span><span class="token punctuation">(</span><span class="token string">&quot;ID&quot;</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token class-name"><span class="token keyword">object</span></span> modalid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ID <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>modalid <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">?</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>modalid <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ID<span class="token punctuation">;</span>

        <span class="token comment">// Get the current record - this will check if the id is different from the current record and only update if it's changed</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">GetRecordAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_ID<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Set the error message - it will only be displayed if we have an error</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>RecordErrorMessage <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$&quot;The Application can't load the Record with ID: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">this</span><span class="token punctuation">.</span>_ID</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>

        <span class="token comment">// Set the Loading flag</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>setLoading<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token comment">//  call Render only if we are not responding to first load</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstload<span class="token punctuation">)</span> <span class="token keyword">await</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// CEC.Blazor/Components/BaseForms/EditComponentBase.cs</span>
<span class="token keyword">protected</span> <span class="token keyword">async</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstLoad <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> setLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// yield to allow fired event can run before we load the record</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">LoadRecordAsync</span><span class="token punctuation">(</span>firstLoad<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>firstLoad<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set up the edit context</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_EditContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EditContext</span><span class="token punctuation">(</span>RecordEditorContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// pass it back to the `RecordEditorContext`</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span><span class="token function">NotifyEditContextChangedAsync</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// wire up the onfieldchanged event.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span>OnFieldChanged <span class="token operator">+=</span> onFieldChanged<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>Loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Some points to note:</p> <ol><li>We connect up <code>WeatherForecastEditorContext</code> and then reset the record before loading it.  This isn't a problem because <code>WeatherForecastEditorContext</code> is connected to the service <code>RecordCollection</code> which <code>ResetRecordAsync</code> only clears.  <code>LoadRecordAsync</code> gets the record and repopulates the <code>RecordCollection</code> before the editor section of the form is displayed. That's controlled by the <code>UIErrorHandler</code> component which only renders the editor section of the form when loading has completed.</li> <li></li></ol> <h4 id="event-handlers"><a href="#event-handlers" class="header-anchor">#</a> Event Handlers</h4> <p>There's one event handler wired up in the form.  Whenever a field changes <code>SetViewManagerLock</code> checks the edit state of the <code>RecordEditorContext</code> and unlocks or locks the form and sorts out the form message.  View locking prevents the user exiting the form without accpeting the data loss.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/BaseForms/EditRecordFormBase.cs</span>
<span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">onFieldChanged</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">object</span></span> sender<span class="token punctuation">,</span> <span class="token class-name">EventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>IsDirty<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">LockView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">SetAlert</span><span class="token punctuation">(</span><span class="token string">&quot;The Record isn't Saved&quot;</span><span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Warning<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ViewManager<span class="token punctuation">.</span><span class="token function">UnLockView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">ClearAlert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="action-button-events"><a href="#action-button-events" class="header-anchor">#</a> Action Button Events</h4> <p>There are various actions wired up to buttons.  The important one is save.  The others are all self-evident.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Blazor/Components/BaseForms/EditRecordComponentBase.cs</span>
<span class="token comment">/// Save Method called from the Button</span>
<span class="token keyword">protected</span> <span class="token keyword">virtual</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">&gt;</span></span> <span class="token function">Save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> ok <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// Validate the EditContext</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">Validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Save the Record</span>
        ok <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span><span class="token function">SaveRecordAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ok<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Set the EditContext State</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>RecordEditorContext<span class="token punctuation">.</span>EditContext<span class="token punctuation">.</span><span class="token function">MarkAsUnmodified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Set the View Lock i.e. unlock it</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">SetViewManagerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Set the alert message to the return result</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">SetAlert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">.</span>TaskResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Trigger a component State update - buttons and alert need to be sorted</span>
        <span class="token keyword">await</span> <span class="token function">RenderAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>AlertMessage<span class="token punctuation">.</span><span class="token function">SetAlert</span><span class="token punctuation">(</span><span class="token string">&quot;A validation error occurred.  Check individual fields for the relevant error.&quot;</span><span class="token punctuation">,</span> MessageType<span class="token punctuation">.</span>Danger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ok<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="implementing-viewer-pages"><a href="#implementing-viewer-pages" class="header-anchor">#</a> Implementing Viewer Pages</h2> <h3 id="the-view-2"><a href="#the-view-2" class="header-anchor">#</a> The View</h3> <p>The view is a very simple.  It contains the form to load.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>@<span class="token keyword">using</span> CEC<span class="token punctuation">.</span>Weather<span class="token punctuation">.</span>Components

@<span class="token keyword">namespace</span> CEC<span class="token punctuation">.</span>Weather<span class="token punctuation">.</span>Components<span class="token punctuation">.</span>Views
@implements IView

@inherits ViewBase

<span class="token operator">&lt;</span><span class="token class-name">WeatherForecastViewerForm</span> ID<span class="token operator">=</span><span class="token string">&quot;this.ID&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>WeatherForecastViewerForm<span class="token operator">&gt;</span>

@code <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Parameter</span></span><span class="token punctuation">]</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="the-form-2"><a href="#the-form-2" class="header-anchor">#</a> The Form</h3> <p>The code file is also relatively simple. <code>RecordFormBase</code> boilerplate code loads the record. Most of the detail in the razor markup.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Weather/Components/Forms/WeatherViewerForm.razor</span>
<span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">WeatherForecastViewerForm</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">RecordFormBase<span class="token punctuation">&lt;</span>DbWeatherForecast<span class="token punctuation">,</span> WeatherForecastDbContext<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Inject</span></span><span class="token punctuation">]</span>
    <span class="token keyword">private</span> <span class="token return-type class-name">WeatherForecastControllerService</span> ControllerService <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> PageTitle <span class="token operator">=&gt;</span> <span class="token interpolation-string"><span class="token string">$&quot;Weather Forecast Viewer </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp"><span class="token keyword">this</span><span class="token punctuation">.</span>Service<span class="token punctuation">?.</span>Record<span class="token punctuation">?.</span>Date<span class="token punctuation">.</span><span class="token function">AsShortDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token keyword">string</span><span class="token punctuation">.</span>Empty</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Task</span> <span class="token function">OnRenderAsync</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">bool</span></span> firstRender<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Service <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ControllerService<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnRenderAsync</span><span class="token punctuation">(</span>firstRender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This gets and assigns the specific ControllerService through DI to the <code>IContollerService Service</code> Property.</p> <p>The Razor Markup below is an abbreviated version of the full file.  This makes extensive use of UIControls which will be covered in detail in a later article.  See the comments for detail.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// CEC.Weather/Components/Forms/WeatherViewerForm.razor.cs</span>
<span class="token comment">// UI Card is a Bootstrap Card</span>
<span class="token operator">&lt;</span><span class="token class-name">UICard</span> IsCollapsible<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Header<span class="token operator">&gt;</span>
        @<span class="token keyword">this</span><span class="token punctuation">.</span>PageTitle
    <span class="token operator">&lt;</span><span class="token operator">/</span>Header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>Body<span class="token operator">&gt;</span>
        <span class="token comment">// Error handler - only renders it's content when the record exists and is loaded</span>
        <span class="token operator">&lt;</span><span class="token class-name">UIErrorHandler</span> IsError<span class="token operator">=</span><span class="token string">&quot;@this.IsError&quot;</span> IsLoading<span class="token operator">=</span><span class="token string">&quot;this.Loading&quot;</span> ErrorMessage<span class="token operator">=</span><span class="token string">&quot;@this.RecordErrorMessage&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>UIContainer<span class="token operator">&gt;</span>
                    <span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span>
                    <span class="token comment">// Example data value row with label and edit control</span>
                    <span class="token operator">&lt;</span>UIRow<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token class-name">UILabelColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            Date
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UILabelColumn<span class="token operator">&gt;</span>

                        <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">FormControlPlainText</span> Value<span class="token operator">=</span><span class="token string">&quot;@this.Service.Record.Date.AsShortDate()&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>FormControlPlainText<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>

                        <span class="token operator">&lt;</span><span class="token class-name">UILabelColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            ID
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UILabelColumn<span class="token operator">&gt;</span>

                        <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">FormControlPlainText</span> Value<span class="token operator">=</span><span class="token string">&quot;@this.Service.Record.ID.ToString()&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>FormControlPlainText<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>

                        <span class="token operator">&lt;</span><span class="token class-name">UILabelColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            Frost
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UILabelColumn<span class="token operator">&gt;</span>

                        <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;2&quot;</span><span class="token operator">&gt;</span>
                            <span class="token operator">&lt;</span><span class="token class-name">FormControlPlainText</span> Value<span class="token operator">=</span><span class="token string">&quot;@this.Service.Record.Frost.AsYesNo()&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>FormControlPlainText<span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIRow<span class="token operator">&gt;</span>
                    <span class="token range operator">..</span><span class="token range operator">..</span><span class="token punctuation">.</span> <span class="token comment">// more form rows here</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>UIContainer<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>UIErrorHandler<span class="token operator">&gt;</span>
        <span class="token comment">// Container for the buttons - not record dependant so outside the error handler to allow navigation if UIErrorHandler is in error.</span>
        <span class="token operator">&lt;</span>UIContainer<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>UIRow<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">UIColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;6&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Show<span class="token operator">=</span><span class="token string">&quot;this.IsLoaded&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.dark&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;(e =&gt; this.NextRecord(-1))&quot;</span><span class="token operator">&gt;</span>
                        Previous
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Show<span class="token operator">=</span><span class="token string">&quot;this.IsLoaded&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.dark&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;(e =&gt; this.NextRecord(1))&quot;</span><span class="token operator">&gt;</span>
                        Next
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>UIColumn<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token class-name">UIButtonColumn</span> Columns<span class="token operator">=</span><span class="token string">&quot;6&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token class-name">UIButton</span> Show<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> ColourCode<span class="token operator">=</span><span class="token string">&quot;Bootstrap.ColourCode.nav&quot;</span> ClickEvent<span class="token operator">=</span><span class="token string">&quot;(e =&gt; this.Exit())&quot;</span><span class="token operator">&gt;</span>
                        Exit
                    <span class="token operator">&lt;</span><span class="token operator">/</span>UIButton<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>UIButtonColumn<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>UIRow<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>UIContainer<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>Body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>UICard<span class="token operator">&gt;</span>
</code></pre></div><h3 id="wrap-up"><a href="#wrap-up" class="header-anchor">#</a> Wrap Up</h3> <p>That wraps up this article.  We've looked at the Editor code in detail to see how it works, and then taken a quick look at the Viewer code.  We'll look in more detail at the List components in a separate article.<br>
Some key points to note:</p> <ol><li>The Blazor Server and Blazor WASM code is the same - it's in the common library.</li> <li>Almost all the functionality is implemented in the library components.  Most of the application code is Razor markup for the individual record fields.</li> <li>The Razor files contains controls, not HTML.</li> <li>Async functionality in used through.</li></ol> <h2 id="history"><a href="#history" class="header-anchor">#</a> History</h2> <ul><li>19-Sep-2020: Initial version.</li> <li>17-Nov-2020: Major Blazor.CEC library changes.  Change to ViewManager from Router and new Component base implementation.</li> <li>7-Feb-2021: Major updates to Services, project structure and data editing.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-2.html" class="prev">
        Building the Services
      </a></span> <span class="next"><a href="/Building-a-Database-Application-in-Blazor/Building-a-Database-Application-in-Blazor-Part-4.html">
        Part 4 - UI Components
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.e3bfb77f.js" defer></script><script src="/assets/js/3.5e2b9483.js" defer></script><script src="/assets/js/15.aa16269d.js" defer></script>
  </body>
</html>
